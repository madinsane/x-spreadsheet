!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(t,e){},function(t,e,n){},function(t,e,n){"use strict";function i(t){return function(t){if(Array.isArray(t))return t}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}n.r(e);var o=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";r(this,t),"string"==typeof e?(this.el=document.createElement(e),this.el.className=n):this.el=e,this.data={}}var e,n,o;return e=t,(n=[{key:"data",value:function(t,e){return void 0!==e?(this.data[t]=e,this):this.data[t]}},{key:"on",value:function(t,e){var n=i(t.split(".")),r=n[0],a=n.slice(1),o=r;return"mousewheel"===o&&/Firefox/i.test(window.navigator.userAgent)&&(o="DOMMouseScroll"),this.el.addEventListener(o,(function(t){e(t);for(var n=0;n<a.length;n+=1){var i=a[n];if("left"===i&&0!==t.button)return;if("right"===i&&2!==t.button)return;"stop"===i&&t.stopPropagation()}})),this}},{key:"offset",value:function(t){var e=this;if(void 0!==t)return Object.keys(t).forEach((function(n){e.css(n,"".concat(t[n],"px"))})),this;var n=this.el;return{top:n.offsetTop,left:n.offsetLeft,height:n.offsetHeight,width:n.offsetWidth}}},{key:"scroll",value:function(t){var e=this.el;return void 0!==t&&(void 0!==t.left&&(e.scrollLeft=t.left),void 0!==t.top&&(e.scrollTop=t.top)),{left:e.scrollLeft,top:e.scrollTop}}},{key:"box",value:function(){return this.el.getBoundingClientRect()}},{key:"parent",value:function(){return new t(this.el.parentNode)}},{key:"children",value:function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return 0===arguments.length?this.el.childNodes:(n.forEach((function(e){return t.child(e)})),this)}},{key:"removeChild",value:function(t){this.el.removeChild(t)}},{key:"child",value:function(e){var n=e;return"string"==typeof e?n=document.createTextNode(e):e instanceof t&&(n=e.el),this.el.appendChild(n),this}},{key:"contains",value:function(t){return this.el.contains(t)}},{key:"className",value:function(t){return void 0!==t?(this.el.className=t,this):this.el.className}},{key:"addClass",value:function(t){return this.el.classList.add(t),this}},{key:"hasClass",value:function(t){return this.el.classList.contains(t)}},{key:"removeClass",value:function(t){return this.el.classList.remove(t),this}},{key:"toggle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"active";return this.toggleClass(t)}},{key:"toggleClass",value:function(t){return this.el.classList.toggle(t)}},{key:"active",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"active";return t?this.addClass(e):this.removeClass(e),this}},{key:"checked",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.active(t,"checked"),this}},{key:"disabled",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return t?this.addClass("disabled"):this.removeClass("disabled"),this}},{key:"attr",value:function(t,e){var n=this;if(void 0!==e)this.el.setAttribute(t,e);else{if("string"==typeof t)return this.el.getAttribute(t);Object.keys(t).forEach((function(e){n.el.setAttribute(e,t[e])}))}return this}},{key:"removeAttr",value:function(t){return this.el.removeAttribute(t),this}},{key:"html",value:function(t){return void 0!==t?(this.el.innerHTML=t,this):this.el.innerHTML}},{key:"val",value:function(t){return void 0!==t?(this.el.value=t,this):this.el.value}},{key:"focus",value:function(){this.el.focus()}},{key:"cssRemoveKeys",value:function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return n.forEach((function(e){return t.el.style.removeProperty(e)})),this}},{key:"css",value:function(t,e){var n=this;return void 0===e&&"string"!=typeof t?(Object.keys(t).forEach((function(e){n.el.style[e]=t[e]})),this):void 0!==e?(this.el.style[t]=e,this):this.el.style[t]}},{key:"computedStyle",value:function(){return window.getComputedStyle(this.el,null)}},{key:"show",value:function(){return this.css("display","block"),this}},{key:"hide",value:function(){return this.css("display","none"),this}}])&&a(e.prototype,n),o&&a(e,o),t}(),l=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new o(t,e)};n(0);function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(i=(o=l.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{i||null==l.return||l.return()}finally{if(r)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var c=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function u(t){for(var e="",n=t;n>=c.length;)n/=c.length,n-=1,e+=c[parseInt(n,10)%c.length];return e+=c[t%c.length]}function h(t){for(var e=0,n=0;n<t.length-1;n+=1){var i=t.charCodeAt(n)-65,r=t.length-1-n;e+=Math.pow(c.length,r)+c.length*i}return e+=t.charCodeAt(t.length-1)-65}function f(t){for(var e="",n="",i=0;i<t.length;i+=1)t.charAt(i)>="0"&&t.charAt(i)<="9"?n+=t.charAt(i):e+=t.charAt(i);return[h(e),parseInt(n,10)-1]}function d(t,e){return"".concat(u(t)).concat(e+1)}function v(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){return!0};if(0===e&&0===n)return t;var r=f(t),a=s(r,2),o=a[0],l=a[1];return i(o,l)?d(o+e,l+n):t}function p(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(i=(o=l.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{i||null==l.return||l.return()}finally{if(r)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var b=function(){function t(e,n,i,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;y(this,t),this.sri=e,this.sci=n,this.eri=i,this.eci=r,this.w=a,this.h=o}var e,n,i;return e=t,i=[{key:"valueOf",value:function(e){var n=e.split(":"),i=p(f(n[0]),2),r=i[0],a=i[1],o=a,l=r;if(n.length>1){var s=p(f(n[1]),2);l=s[0],o=s[1]}return new t(a,r,o,l)}}],(n=[{key:"set",value:function(t,e,n,i){this.sri=t,this.sci=e,this.eri=n,this.eci=i}},{key:"multiple",value:function(){return this.eri-this.sri>0||this.eci-this.sci>0}},{key:"includes",value:function(){for(var t=0,e=0,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];if(1===i.length){var a=f(i[0]),o=p(a,2);e=o[0],t=o[1]}else 2===i.length&&(t=i[0],e=i[1]);var l=this.sri,s=this.sci,c=this.eri,u=this.eci;return l<=t&&t<=c&&s<=e&&e<=u}},{key:"each",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},n=this.sri,i=this.sci,r=this.eri,a=this.eci,o=n;o<=r;o+=1)if(e(o))for(var l=i;l<=a;l+=1)t(o,l)}},{key:"contains",value:function(t){return this.sri<=t.sri&&this.sci<=t.sci&&this.eri>=t.eri&&this.eci>=t.eci}},{key:"within",value:function(t){return this.sri>=t.sri&&this.sci>=t.sci&&this.eri<=t.eri&&this.eci<=t.eci}},{key:"disjoint",value:function(t){return this.sri>t.eri||this.sci>t.eci||t.sri>this.eri||t.sci>this.eci}},{key:"intersects",value:function(t){return this.sri<=t.eri&&this.sci<=t.eci&&t.sri<=this.eri&&t.sci<=this.eci}},{key:"union",value:function(e){var n=this.sri,i=this.sci,r=this.eri,a=this.eci;return new t(e.sri<n?e.sri:n,e.sci<i?e.sci:i,e.eri>r?e.eri:r,e.eci>a?e.eci:a)}},{key:"difference",value:function(e){var n=[],i=function(e,i,r,a){n.push(new t(e,i,r,a))},r=this.sri,a=this.sci,o=this.eri,l=this.eci,s=e.sri-r,c=e.sci-a,u=o-e.eri,h=l-e.eci;return s>0?(i(r,a,e.sri-1,l),u>0?(i(e.eri+1,a,o,l),c>0&&i(e.sri,a,e.eri,e.sci-1),h>0&&i(e.sri,e.eci+1,e.eri,l)):(c>0&&i(e.sri,a,o,e.sci-1),h>0&&i(e.sri,e.eci+1,o,l))):u>0&&(i(e.eri+1,a,o,l),c>0&&i(r,a,e.eri,e.sci-1),h>0&&i(r,e.eci+1,e.eri,l)),c>0?(i(r,a,o,e.sci-1),h>0?(i(r,e.eri+1,o,l),s>0&&i(r,e.sci,e.sri-1,e.eci),u>0&&i(e.sri+1,e.sci,o,e.eci)):(s>0&&i(r,e.sci,e.sri-1,l),u>0&&i(e.sri+1,e.sci,o,l))):h>0&&(i(o,e.eci+1,o,l),s>0&&i(r,a,e.sri-1,e.eci),u>0&&i(e.eri+1,a,o,e.eci)),n}},{key:"size",value:function(){return[this.eri-this.sri+1,this.eci-this.sci+1]}},{key:"toString",value:function(){var t=this.sri,e=this.sci,n=this.eri,i=this.eci,r=d(e,t);return this.multiple()&&(r="".concat(r,":").concat(d(i,n))),r}},{key:"clone",value:function(){return new t(this.sri,this.sci,this.eri,this.eci,this.w,this.h)}},{key:"equals",value:function(t){return this.eri===t.eri&&this.eci===t.eci&&this.sri===t.sri&&this.sci===t.sci}}])&&g(e.prototype,n),i&&g(e,i),t}();function m(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var w=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.range=new b(0,0,0,0),this.ri=0,this.ci=0}var e,n,i;return e=t,(n=[{key:"multiple",value:function(){return this.range.multiple()}},{key:"setIndexes",value:function(t,e){this.ri=t,this.ci=e}},{key:"size",value:function(){return this.range.size()}}])&&m(e.prototype,n),i&&m(e,i),t}();var k=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=0,this.y=0,this.ri=0,this.ci=0};function x(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var O=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.undoItems=[],this.redoItems=[]}var e,n,i;return e=t,(n=[{key:"add",value:function(t){this.undoItems.push(JSON.stringify(t)),this.redoItems=[]}},{key:"canUndo",value:function(){return this.undoItems.length>0}},{key:"canRedo",value:function(){return this.redoItems.length>0}},{key:"undo",value:function(t,e){var n=this.undoItems,i=this.redoItems;this.canUndo()&&(i.push(JSON.stringify(t)),e(JSON.parse(n.pop())))}},{key:"redo",value:function(t,e){var n=this.undoItems,i=this.redoItems;this.canRedo()&&(n.push(JSON.stringify(t)),e(JSON.parse(i.pop())))}}])&&x(e.prototype,n),i&&x(e,i),t}();function E(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var C=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.range=null,this.state="clear"}var e,n,i;return e=t,(n=[{key:"copy",value:function(t){return this.range=t,this.state="copy",this}},{key:"cut",value:function(t){return this.range=t,this.state="cut",this}},{key:"isCopy",value:function(){return"copy"===this.state}},{key:"isCut",value:function(){return"cut"===this.state}},{key:"isClear",value:function(){return"clear"===this.state}},{key:"clear",value:function(){this.range=null,this.state="clear"}}])&&E(e.prototype,n),i&&E(e,i),t}();function S(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function A(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function T(t,e,n){return e&&A(t.prototype,e),n&&A(t,n),t}var j=function(){function t(e,n,i){S(this,t),this.ci=e,this.operator=n,this.value=i}return T(t,[{key:"set",value:function(t,e){this.operator=t,this.value=e}},{key:"includes",value:function(t){var e=this.operator,n=this.value;return"all"===e||"in"===e&&n.includes(t)}},{key:"vlength",value:function(){var t=this.operator,e=this.value;return"in"===t?e.length:0}},{key:"getData",value:function(){return{ci:this.ci,operator:this.operator,value:this.value}}}]),t}(),D=function(){function t(e,n){S(this,t),this.ci=e,this.order=n}return T(t,[{key:"asc",value:function(){return"asc"===this.order}},{key:"desc",value:function(){return"desc"===this.order}}]),t}(),I=function(){function t(){S(this,t),this.ref=null,this.filters=[],this.sort=null}return T(t,[{key:"setData",value:function(t){var e=t.ref,n=t.filters,i=t.sort;null!=e&&(this.ref=e,this.filters=n.map((function(t){return new j(t.ci,t.operator,t.value)})),i&&(this.sort=new D(i.ci,i.order)))}},{key:"getData",value:function(){if(this.active()){var t=this.ref,e=this.filters,n=this.sort;return{ref:t,filters:e.map((function(t){return t.getData()})),sort:n}}return{}}},{key:"addFilter",value:function(t,e,n){var i=this.getFilter(t);null==i?this.filters.push(new j(t,e,n)):i.set(e,n)}},{key:"setSort",value:function(t,e){this.sort=e?new D(t,e):null}},{key:"includes",value:function(t,e){return!!this.active()&&this.hrange().includes(t,e)}},{key:"getSort",value:function(t){var e=this.sort;return e&&e.ci===t?e:null}},{key:"getFilter",value:function(t){for(var e=this.filters,n=0;n<e.length;n+=1)if(e[n].ci===t)return e[n];return null}},{key:"filteredRows",value:function(t){var e=new Set,n=new Set;if(this.active())for(var i=this.range(),r=i.sri,a=i.eri,o=this.filters,l=r+1;l<=a;l+=1)for(var s=0;s<o.length;s+=1){var c=o[s],u=t(l,c.ci),h=u?u.text:"";if(!c.includes(h)){e.add(l);break}n.add(l)}return{rset:e,fset:n}}},{key:"items",value:function(t,e){var n={};if(this.active())for(var i=this.range(),r=i.sri,a=i.eri,o=r+1;o<=a;o+=1){var l=e(o,t);if(null===l||/^\s*$/.test(l.text))n[""]=(n[""]||0)+1;else{var s=l.text,c=(n[s]||0)+1;n[s]=c}}return n}},{key:"range",value:function(){return b.valueOf(this.ref)}},{key:"hrange",value:function(){var t=this.range();return t.eri=t.sri,t}},{key:"clear",value:function(){this.ref=null,this.filters=[],this.sort=null}},{key:"active",value:function(){return null!==this.ref}}]),t}();function R(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function P(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var _=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];R(this,t),this._=e}var e,n,i;return e=t,(n=[{key:"forEach",value:function(t){this._.forEach(t)}},{key:"deleteWithin",value:function(t){this._=this._.filter((function(e){return!e.within(t)}))}},{key:"getFirstIncludes",value:function(t,e){for(var n=0;n<this._.length;n+=1){var i=this._[n];if(i.includes(t,e))return i}return null}},{key:"filterIntersects",value:function(e){return new t(this._.filter((function(t){return t.intersects(e)})))}},{key:"intersects",value:function(t){for(var e=0;e<this._.length;e+=1)if(this._[e].intersects(t))return!0;return!1}},{key:"union",value:function(t){var e=t;return this._.forEach((function(t){t.intersects(e)&&(e=t.union(e))})),e}},{key:"add",value:function(t){this.deleteWithin(t),this._.push(t)}},{key:"shift",value:function(t,e,n,i){this._.forEach((function(r){var a=r.sri,o=r.sci,l=r.eri,s=r.eci,c=r;"row"===t?a>=e?(c.sri+=n,c.eri+=n):a<e&&e<=l&&(c.eri+=n,i(a,o,n,0)):"column"===t&&(o>=e?(c.sci+=n,c.eci+=n):o<e&&e<=s&&(c.eci+=n,i(a,o,0,n)))}))}},{key:"move",value:function(t,e,n){this._.forEach((function(i){var r=i;r.within(t)&&(r.eri+=e,r.sri+=e,r.sci+=n,r.eci+=n)}))}},{key:"setData",value:function(t){return this._=t.map((function(t){return b.valueOf(t)})),this}},{key:"getData",value:function(){return this._.map((function(t){return t.toString()}))}}])&&P(e.prototype,n),i&&P(e,i),t}();var z=function t(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return i.forEach((function(n){Object.keys(n).forEach((function(i){var r=n[i];"string"==typeof r||"number"==typeof r||"boolean"==typeof r?e[i]=r:"function"!=typeof r&&!Array.isArray(r)&&r instanceof Object?(e[i]=e[i]||{},t(e[i],r)):e[i]=r}))})),e};function H(t){for(var e="".concat(t),n=0,i=!1,r=0;r<e.length;r+=1)!0===i&&(n+=1),"."===e.charAt(r)&&(i=!0);return n}function M(t,e,n){if(Number.isNaN(e)||Number.isNaN(n))return e+t+n;var i=H(e),r=H(n),a=Number(e),o=Number(n),l=0;if("-"===t)l=a-o;else if("+"===t)l=a+o;else if("*"===t)l=a*o;else if("/"===t)return H(l=a/o)>5?l.toFixed(2):l;return l.toFixed(Math.max(i,r))}var F={cloneDeep:function(t){return JSON.parse(JSON.stringify(t))},merge:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return z.apply(void 0,[{}].concat(e))},equals:function t(e,n){var i=Object.keys(e);if(i.length!==Object.keys(n).length)return!1;for(var r=0;r<i.length;r+=1){var a=i[r],o=e[a],l=n[a];if(void 0===l)return!1;if("string"==typeof o||"number"==typeof o||"boolean"==typeof o){if(o!==l)return!1}else if(Array.isArray(o)){if(o.length!==l.length)return!1;for(var s=0;s<o.length;s+=1)if(!t(o[s],l[s]))return!1}else if("function"!=typeof o&&!Array.isArray(o)&&o instanceof Object&&!t(o,l))return!1}return!0},arrayEquals:function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n+=1)if(t[n]!==e[n])return!1;return!0},sum:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){return t},n=0,i=0;return Object.keys(t).forEach((function(r){n+=e(t[r],r),i+=1})),[n,i]},rangeEach:function(t,e,n){for(var i=t;i<e;i+=1)n(i)},rangeSum:function(t,e,n){for(var i=0,r=t;r<e;r+=1)i+=n(r);return i},rangeReduceIf:function(t,e,n,i,r,a){for(var o=n,l=i,s=t;s<e&&!(o>r);s+=1)o+=l=a(s);return[s,o-l,l]},deleteProperty:function(t,e){var n=t["".concat(e)];return delete t["".concat(e)],n},numberCalc:M};function N(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(i=(o=l.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{i||null==l.return||l.return()}finally{if(r)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function W(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var V=function(){function t(e){var n=e.len,i=e.height;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.content={},this.len=n,this.height=i}var e,n,i;return e=t,(n=[{key:"getHeight",value:function(t){if(this.isHide(t))return 0;var e=this.get(t);return e&&e.height?e.height:this.height}},{key:"setHeight",value:function(t,e){this.getOrNew(t).height=e}},{key:"unhide",value:function(t){for(var e=t;e>0&&(e-=1,this.isHide(e));)this.setHide(e,!1)}},{key:"isHide",value:function(t){var e=this.get(t);return e&&e.hide}},{key:"setHide",value:function(t,e){var n=this.getOrNew(t);!0===e?n.hide=!0:delete n.hide}},{key:"setStyle",value:function(t,e){this.getOrNew(t).style=e}},{key:"sumHeight",value:function(t,e,n){var i=this;return F.rangeSum(t,e,(function(t){return n&&n.has(t)?0:i.getHeight(t)}))}},{key:"totalHeight",value:function(){return this.sumHeight(0,this.len)}},{key:"get",value:function(t){return this.content[t]}},{key:"getOrNew",value:function(t){return this.content[t]=this.content[t]||{cells:{}},this.content[t]}},{key:"getCell",value:function(t,e){var n=this.get(t);return void 0!==n&&void 0!==n.cells&&void 0!==n.cells[e]?n.cells[e]:null}},{key:"getCellMerge",value:function(t,e){var n=this.getCell(t,e);return n&&n.merge?n.merge:[0,0]}},{key:"getCellOrNew",value:function(t,e){var n=this.getOrNew(t);return n.cells[e]=n.cells[e]||{},n.cells[e]}},{key:"setCell",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"all",r=this.getOrNew(t);"all"===i?r.cells[e]=n:"text"===i?(r.cells[e]=r.cells[e]||{},r.cells[e].text=n.text):"format"===i&&(r.cells[e]=r.cells[e]||{},r.cells[e].style=n.style,n.merge&&(r.cells[e].merge=n.merge))}},{key:"setCellText",value:function(t,e,n){var i=this.getCellOrNew(t,e);!1!==i.editable&&(i.text=n)}},{key:"copyPaste",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){},a=t.sri,o=t.sci,l=t.eri,s=t.eci,c=e.sri,u=e.sci,h=e.eri,f=e.eci,d=t.size(),p=N(d,2),y=p[0],g=p[1],b=e.size(),m=N(b,2),w=m[0],k=m[1],x=!0,O=0;(h<a||f<o)&&(x=!1,O=h<a?w:k);for(var E=a;E<=l;E+=1)if(this.content[E])for(var C=o;C<=s;C+=1)if(this.content[E].cells&&this.content[E].cells[C])for(var S=c;S<=h;S+=y)for(var A=u;A<=f;A+=g){var T=S+(E-a),j=A+(C-o),D=F.cloneDeep(this.content[E].cells[C]);i&&D&&D.text&&D.text.length>0&&function(){var t=D.text,e=A-u+(S-c)+2;if(x||(e-=O+1),"="===t[0])D.text=t.replace(/[a-zA-Z]{1,3}\d+/g,(function(t){var n=0,i=0;return a===c?n=e-1:i=e-1,/^\d+$/.test(t)?t:v(t,n,i)}));else if(y<=1&&g>1&&(c>l||h<a)||g<=1&&y>1&&(u>s||f<o)||y<=1&&g<=1){var n=/[\\.\d]+$/.exec(t);if(null!==n){var i=Number(n[0])+e-1;D.text=t.substring(0,n.index)+i}}}(),this.setCell(T,j,D,n),r(T,j,D)}}},{key:"cutPaste",value:function(t,e){var n=this,i={};this.each((function(r){n.eachCells(r,(function(a){var o=parseInt(r,10),l=parseInt(a,10);t.includes(r,a)&&(o=e.sri+(o-t.sri),l=e.sci+(l-t.sci)),i[o]=i[o]||{cells:{}},i[o].cells[l]=n.content[r].cells[a]}))})),this.content=i}},{key:"paste",value:function(t,e){var n=this;if(!(t.length<=0)){var i=e.sri,r=e.sci;t.forEach((function(t,e){var a=i+e;t.forEach((function(t,e){var i=r+e;n.setCellText(a,i,t)}))}))}}},{key:"insert",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i={};this.each((function(r,a){var o=parseInt(r,10);o>=t&&(o+=n,e.eachCells(r,(function(e,i){i.text&&"="===i.text[0]&&(i.text=i.text.replace(/[a-zA-Z]{1,3}\d+/g,(function(e){return v(e,0,n,(function(e,n){return n>=t}))})))}))),i[o]=a})),this.content=i,this.len+=n}},{key:"delete",value:function(t,e){var n=this,i=e-t+1,r={};this.each((function(a,o){var l=parseInt(a,10);l<t?r[l]=o:a>e&&(r[l-i]=o,n.eachCells(a,(function(t,n){n.text&&"="===n.text[0]&&(n.text=n.text.replace(/[a-zA-Z]{1,3}\d+/g,(function(t){return v(t,0,-i,(function(t,n){return n>e}))})))})))})),this.content=r,this.len-=i}},{key:"insertColumn",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.each((function(i,r){var a={};e.eachCells(i,(function(e,i){var r=parseInt(e,10);r>=t&&(r+=n,i.text&&"="===i.text[0]&&(i.text=i.text.replace(/[a-zA-Z]{1,3}\d+/g,(function(e){return v(e,n,0,(function(e){return e>=t}))})))),a[r]=i})),r.cells=a}))}},{key:"deleteColumn",value:function(t,e){var n=this,i=e-t+1;this.each((function(r,a){var o={};n.eachCells(r,(function(n,r){var a=parseInt(n,10);a<t?o[a]=r:a>e&&(o[a-i]=r,r.text&&"="===r.text[0]&&(r.text=r.text.replace(/[a-zA-Z]{1,3}\d+/g,(function(t){return v(t,-i,0,(function(t){return t>e}))}))))})),a.cells=o}))}},{key:"deleteCells",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";t.each((function(t,i){e.deleteCell(t,i,n)}))}},{key:"deleteCell",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"all",i=this.get(t);if(null!==i){var r=this.getCell(t,e);null!==r&&!1!==r.editable&&("all"===n?delete i.cells[e]:"text"===n?(r.text&&delete r.text,r.value&&delete r.value):"format"===n?(void 0!==r.style&&delete r.style,r.merge&&delete r.merge):"merge"===n&&r.merge&&delete r.merge)}}},{key:"maxCell",value:function(){var t=Object.keys(this.content),e=t[t.length-1],n=this.content[e];if(n){var i=n.cells,r=Object.keys(i),a=r[r.length-1];return[parseInt(e,10),parseInt(a,10)]}return[0,0]}},{key:"each",value:function(t){Object.entries(this.content).forEach((function(e){var n=N(e,2),i=n[0],r=n[1];t(i,r)}))}},{key:"eachCells",value:function(t,e){this.content[t]&&this.content[t].cells&&Object.entries(this.content[t].cells).forEach((function(t){var n=N(t,2),i=n[0],r=n[1];e(i,r)}))}},{key:"setData",value:function(t){t.len&&(this.len=t.len,delete t.len),this.content=t}},{key:"getData",value:function(){var t=this.len;return Object.assign({len:t},this.content)}}])&&W(e.prototype,n),i&&W(e,i),t}();function q(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var B=function(){function t(e){var n=e.len,i=e.width,r=e.indexWidth,a=e.minWidth;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._={},this.len=n,this.width=i,this.indexWidth=r,this.minWidth=a}var e,n,i;return e=t,(n=[{key:"setData",value:function(t){t.len&&(this.len=t.len,delete t.len),this._=t}},{key:"getData",value:function(){var t=this.len;return Object.assign({len:t},this._)}},{key:"getWidth",value:function(t){if(this.isHide(t))return 0;var e=this._[t];return e&&e.width?e.width:this.width}},{key:"getOrNew",value:function(t){return this._[t]=this._[t]||{},this._[t]}},{key:"setWidth",value:function(t,e){this.getOrNew(t).width=e}},{key:"unhide",value:function(t){for(var e=t;e>0&&(e-=1,this.isHide(e));)this.setHide(e,!1)}},{key:"isHide",value:function(t){var e=this._[t];return e&&e.hide}},{key:"setHide",value:function(t,e){var n=this.getOrNew(t);!0===e?n.hide=!0:delete n.hide}},{key:"setStyle",value:function(t,e){this.getOrNew(t).style=e}},{key:"sumWidth",value:function(t,e){var n=this;return F.rangeSum(t,e,(function(t){return n.getWidth(t)}))}},{key:"totalWidth",value:function(){return this.sumWidth(0,this.len)}}])&&q(e.prototype,n),i&&q(e,i),t}(),L=["en"],U={en:{toolbar:{undo:"Undo",redo:"Redo",print:"Print",paintformat:"Paint format",clearformat:"Clear format",format:"Format",fontName:"Font",fontSize:"Font size",fontBold:"Font bold",fontItalic:"Font italic",underline:"Underline",strike:"Strike",color:"Text color",bgcolor:"Fill color",border:"Borders",merge:"Merge cells",align:"Horizontal align",valign:"Vertical align",textwrap:"Text wrapping",freeze:"Freeze cell",autofilter:"Filter",formula:"Functions",more:"More"},contextmenu:{copy:"Copy",cut:"Cut",paste:"Paste",pasteValue:"Paste values only",pasteFormat:"Paste format only",hide:"Hide",insertRow:"Insert row",insertColumn:"Insert column",deleteSheet:"Delete",deleteRow:"Delete row",deleteColumn:"Delete column",deleteCell:"Delete cell",deleteCellText:"Delete cell text",validation:"Data validations",cellprintable:"Enable export",cellnonprintable:"Disable export",celleditable:"Enable editing",cellnoneditable:"Disable editing"},print:{size:"Paper size",orientation:"Page orientation",orientations:["Landscape","Portrait"]},format:{normal:"Normal",text:"Plain Text",number:"Number",percent:"Percent",rmb:"RMB",usd:"USD",eur:"EUR",date:"Date",time:"Time",datetime:"Date time",duration:"Duration"},formula:{sum:"Sum",average:"Average",max:"Max",min:"Min",_if:"IF",and:"AND",or:"OR",concat:"Concat"},validation:{required:"it must be required",notMatch:"it not match its validation rule",between:"it is between {} and {}",notBetween:"it is not between {} and {}",notIn:"it is not in list",equal:"it equal to {}",notEqual:"it not equal to {}",lessThan:"it less than {}",lessThanEqual:"it less than or equal to {}",greaterThan:"it greater than {}",greaterThanEqual:"it greater than or equal to {}"},error:{pasteForMergedCell:"Unable to do this for merged cells"},calendar:{weeks:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"]},button:{next:"Next",cancel:"Cancel",remove:"Remove",save:"Save",ok:"OK"},sort:{desc:"Sort Z -> A",asc:"Sort A -> Z"},filter:{empty:"empty"},dataValidation:{mode:"Mode",range:"Cell Range",criteria:"Criteria",modeType:{cell:"Cell",column:"Colun",row:"Row"},type:{list:"List",number:"Number",date:"Date",phone:"Phone",email:"Email"},operator:{be:"between",nbe:"not betwwen",lt:"less than",lte:"less than or equal to",gt:"greater than",gte:"greater than or equal to",eq:"equal to",neq:"not equal to"}}}};function Y(t,e){if(e)for(var n=0,i=L;n<i.length;n++){var r=i[n];if(!e[r])break;for(var a=e[r],o=t.match(/(?:\\.|[^.])+/g),l=0;l<o.length;l+=1){var s=a[o[l]];if(!s)break;if(l===o.length-1)return s;a=s}}}function $(t){var e=Y(t,U);return!e&&window&&window.x_spreadsheet&&window.x_spreadsheet.$messages&&(e=Y(t,window.x_spreadsheet.$messages)),e||""}function X(t){return function(){return $(t)}}function Z(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n?L=[t]:L.unshift(t),e&&(U[t]=e)}function K(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(i=(o=l.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{i||null==l.return||l.return()}finally{if(r)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function J(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var G={phone:/^[1-9]\d{10}$/,email:/w+([-+.]w+)*@w+([-.]w+)*.w+([-.]w+)*/};function Q(t,e){var n="";if(!t){for(var i=arguments.length,r=new Array(i>2?i-2:0),a=2;a<i;a++)r[a-2]=arguments[a];n=$.apply(void 0,["validation.".concat(e)].concat(r))}return[t,n]}var tt=function(){function t(e,n,i,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.required=n,this.value=i,this.type=e,this.operator=r,this.message=""}var e,n,i;return e=t,(n=[{key:"parseValue",value:function(t){var e=this.type;return"date"===e?new Date(t):"number"===e?Number(t):t}},{key:"equals",value:function(t){var e=this.type===t.type&&this.required===t.required&&this.operator===t.operator;return e&&(e=Array.isArray(this.value)?F.arrayEquals(this.value,t.value):this.value===t.value),e}},{key:"values",value:function(){return this.value.split(",")}},{key:"validate",value:function(t){var e=this.required,n=this.operator,i=this.value,r=this.type;if(e&&/^\s*$/.test(t))return Q(!1,"required");if(/^\s*$/.test(t))return[!0];if(G[r]&&!G[r].test(t))return Q(!1,"notMatch");if("list"===r)return Q(this.values().includes(t),"notIn");if(n){var a=this.parseValue(t);if("be"===n){var o=K(i,2),l=o[0],s=o[1];return Q(a>=this.parseValue(l)&&a<=this.parseValue(s),"between",l,s)}if("nbe"===n){var c=K(i,2),u=c[0],h=c[1];return Q(a<this.parseValue(u)||a>this.parseValue(h),"notBetween",u,h)}if("eq"===n)return Q(a===this.parseValue(i),"equal",i);if("neq"===n)return Q(a!==this.parseValue(i),"notEqual",i);if("lt"===n)return Q(a<this.parseValue(i),"lessThan",i);if("lte"===n)return Q(a<=this.parseValue(i),"lessThanEqual",i);if("gt"===n)return Q(a>this.parseValue(i),"greaterThan",i);if("gte"===n)return Q(a>=this.parseValue(i),"greaterThanEqual",i)}return[!0]}}])&&J(e.prototype,n),i&&J(e,i),t}();function et(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(i=(o=l.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{i||null==l.return||l.return()}finally{if(r)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function nt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function it(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function rt(t,e,n){return e&&it(t.prototype,e),n&&it(t,n),t}var at=function(){function t(e,n,i){nt(this,t),this.refs=n,this.mode=e,this.validator=i}return rt(t,[{key:"includes",value:function(t,e){for(var n=this.refs,i=0;i<n.length;i+=1){if(b.valueOf(n[i]).includes(t,e))return!0}return!1}},{key:"addRef",value:function(t){this.remove(b.valueOf(t)),this.refs.push(t)}},{key:"remove",value:function(t){var e=[];this.refs.forEach((function(n){var i=b.valueOf(n);i.intersects(t)?i.difference(t).forEach((function(t){return e.push(t.toString())})):e.push(n)})),this.refs=e}},{key:"getData",value:function(){var t=this.refs,e=this.mode,n=this.validator;return{refs:t,mode:e,type:n.type,required:n.required,operator:n.operator,value:n.value}}}],[{key:"valueOf",value:function(e){var n=e.refs,i=e.mode,r=e.type,a=e.required,o=e.operator,l=e.value;return new t(i,n,new tt(r,a,l,o))}}]),t}(),ot=function(){function t(){nt(this,t),this._=[],this.errors=new Map}return rt(t,[{key:"getError",value:function(t,e){return this.errors.get("".concat(t,"_").concat(e))}},{key:"validate",value:function(t,e,n){var i=this.get(t,e),r="".concat(t,"_").concat(e),a=this.errors;if(null!==i){var o=et(i.validator.validate(n),2),l=o[0],s=o[1];l?a.delete(r):a.set(r,s)}else a.delete(r);return!0}},{key:"add",value:function(t,e,n){var i=n.type,r=n.required,a=n.value,o=n.operator,l=new tt(i,r,a,o),s=this.getByValidator(l);null!==s?s.addRef(e):this._.push(new at(t,[e],l))}},{key:"getByValidator",value:function(t){for(var e=0;e<this._.length;e+=1){var n=this._[e];if(n.validator.equals(t))return n}return null}},{key:"get",value:function(t,e){for(var n=0;n<this._.length;n+=1){var i=this._[n];if(i.includes(t,e))return i}return null}},{key:"remove",value:function(t){this.each((function(e){e.remove(t)}))}},{key:"each",value:function(t){this._.forEach((function(e){return t(e)}))}},{key:"getData",value:function(){return this._.filter((function(t){return t.refs.length>0})).map((function(t){return t.getData()}))}},{key:"setData",value:function(t){this._=t.map((function(t){return at.valueOf(t)}))}}]),t}();function lt(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function st(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ct(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(i=(o=l.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{i||null==l.return||l.return()}finally{if(r)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var ut={mode:"edit",view:{height:function(){return document.documentElement.clientHeight},width:function(){return document.documentElement.clientWidth}},showGrid:!0,showToolbar:!0,showContextmenu:!0,showBottomBar:!0,row:{len:100,height:25},col:{len:26,width:100,indexWidth:60,minWidth:60},style:{bgcolor:"#222222",align:"left",valign:"middle",textwrap:!1,strike:!1,underline:!1,color:"#FFF",font:{name:"Arial",size:10,bold:!1,italic:!1},format:"normal"}},ht=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};function ft(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=this.merges,r=e.clone(),a=t.size(),o=ct(a,2),l=o[0],s=o[1],c=e.size(),u=ct(c,2),h=u[0],f=u[1];return l>h&&(r.eri=e.sri+l-1),s>f&&(r.eci=e.sci+s-1),!i.intersects(r)||(n($("error.pasteForMergedCell")),!1)}function dt(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=this.rows,a=this.merges;"all"!==n&&"format"!==n||(r.deleteCells(e,n),a.deleteWithin(e)),r.copyPaste(t,e,n,i,(function(t,e,n){if(n&&n.merge){var i=ct(n.merge,2),r=i[0],o=i[1];if(r<=0&&o<=0)return;a.add(new b(t,e,t+r,e+o))}}))}function vt(t,e){var n=this.clipboard,i=this.rows,r=this.merges;i.cutPaste(t,e),r.move(t,e.sri-t.sri,e.sci-t.sci),n.clear()}function pt(t,e,n){var i=this.styles,r=this.rows.getCellOrNew(t,e),a={};void 0!==r.style&&(a=F.cloneDeep(i[r.style])),a=F.merge(a,{border:n}),r.style=this.addStyle(a)}function yt(t){var e=this,n=t.mode,i=t.style,r=t.color,a=this.styles,o=this.selector,l=this.rows,s=o.range,c=s.sri,u=s.sci,h=s.eri,f=s.eci,d=!this.isSingleSelected();if(d||"inside"!==n&&"horizontal"!==n&&"vertical"!==n)if("outside"!==n||d){if("none"===n)o.range.each((function(t,n){var i=l.getCell(t,n);if(i&&void 0!==i.style){var r=F.cloneDeep(a[i.style]);delete r.border,i.style=e.addStyle(r)}}));else if("all"===n||"inside"===n||"outside"===n||"horizontal"===n||"vertical"===n)!function(){for(var t=[],a=c;a<=h;a+=1)for(var o=u;o<=f;o+=1){for(var s=[],v=0;v<t.length;v+=1){var p=ct(t[v],4),y=p[0],g=p[1],b=p[2],m=p[3];if(a===y+b+1&&s.push(v),y<=a&&a<=y+b&&o===g){o+=m+1;break}}if(s.forEach((function(e){return t.splice(e,1)})),o>f)break;var w=l.getCell(a,o),k=0,x=0;if(w&&w.merge){var O=ct(w.merge,2);k=O[0],x=O[1],t.push([a,o,k,x])}var E=k>0&&a+k===h,C=x>0&&o+x===f,S={};"all"===n?S={bottom:[i,r],top:[i,r],left:[i,r],right:[i,r]}:"inside"===n?(!C&&o<f&&(S.right=[i,r]),!E&&a<h&&(S.bottom=[i,r])):"horizontal"===n?!E&&a<h&&(S.bottom=[i,r]):"vertical"===n?!C&&o<f&&(S.right=[i,r]):"outside"===n&&d&&(c===a&&(S.top=[i,r]),(E||h===a)&&(S.bottom=[i,r]),u===o&&(S.left=[i,r]),(C||f===o)&&(S.right=[i,r])),Object.keys(S).length>0&&pt.call(e,a,o,S),o+=x}}();else if("top"===n||"bottom"===n)for(var v=u;v<=f;v+=1)"top"===n&&(pt.call(this,c,v,{top:[i,r]}),v+=l.getCellMerge(c,v)[1]),"bottom"===n&&(pt.call(this,h,v,{bottom:[i,r]}),v+=l.getCellMerge(h,v)[1]);else if("left"===n||"right"===n)for(var p=c;p<=h;p+=1)"left"===n&&(pt.call(this,p,u,{left:[i,r]}),p+=l.getCellMerge(p,u)[0]),"right"===n&&(pt.call(this,p,f,{right:[i,r]}),p+=l.getCellMerge(p,f)[0])}else pt.call(this,c,u,{top:[i,r],bottom:[i,r],left:[i,r],right:[i,r]})}function gt(t,e){var n=this.rows,i=this.freezeTotalHeight(),r=n.height;i+n.height<t&&(r-=e);for(var a=this.exceptRowSet,o=0,l=r,s=n.height;o<n.len&&!(l>t);o+=1)a.has(o)||(l+=s=n.getHeight(o));return(l-=s)<=0?{ri:-1,top:0,height:s}:{ri:o-1,top:l,height:s}}function bt(t,e){var n=this.cols,i=this.freezeTotalWidth(),r=n.indexWidth;i+n.indexWidth<t&&(r-=e);var a=ct(F.rangeReduceIf(0,n.len,r,n.indexWidth,t,(function(t){return n.getWidth(t)})),3),o=a[0],l=a[1],s=a[2];return l<=0?{ci:-1,left:0,width:n.indexWidth}:{ci:o-1,left:l,width:s}}var mt=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.settings=F.merge(ut,n||{}),this.name=e||"sheet",this.freeze=[0,0],this.styles=[],this.merges=new _,this.rows=new V(this.settings.row),this.cols=new B(this.settings.col),this.validations=new ot,this.hyperlinks={},this.comments={},this.selector=new w,this.scroll=new k,this.history=new O,this.clipboard=new C,this.autoFilter=new I,this.change=function(){},this.exceptRowSet=new Set,this.sortedRowMap=new Map,this.unsortedRowMap=new Map}var e,n,i;return e=t,(n=[{key:"addValidation",value:function(t,e,n){var i=this;this.changeData((function(){i.validations.add(t,e,n)}))}},{key:"removeValidation",value:function(){var t=this,e=this.selector.range;this.changeData((function(){t.validations.remove(e)}))}},{key:"getSelectedValidator",value:function(){var t=this.selector,e=t.ri,n=t.ci,i=this.validations.get(e,n);return i?i.validator:null}},{key:"getSelectedValidation",value:function(){var t=this.selector,e=t.ri,n=t.ci,i=t.range,r=this.validations.get(e,n),a={ref:i.toString()};return null!==r&&(a.mode=r.mode,a.validator=r.validator),a}},{key:"canUndo",value:function(){return this.history.canUndo()}},{key:"canRedo",value:function(){return this.history.canRedo()}},{key:"undo",value:function(){var t=this;this.history.undo(this.getData(),(function(e){t.setData(e)}))}},{key:"redo",value:function(){var t=this;this.history.redo(this.getData(),(function(e){t.setData(e)}))}},{key:"copy",value:function(){this.clipboard.copy(this.selector.range)}},{key:"copyToSystemClipboard",value:function(){if(void 0!==navigator.clipboard){for(var t="",e=this.rows.getData(),n=this.selector.range.sri;n<=this.selector.range.eri;n+=1){if(ht(e,n)){for(var i=this.selector.range.sci;i<=this.selector.range.eci;i+=1)if(i>this.selector.range.sci&&(t+="\t"),ht(e[n].cells,i)){var r=String(e[n].cells[i].text);-1===r.indexOf("\n")&&-1===r.indexOf("\t")&&-1===r.indexOf('"')?t+=r:t+='"'.concat(r,'"')}}else for(var a=this.selector.range.sci;a<=this.selector.range.eci;a+=1)t+="\t";t+="\n"}navigator.clipboard.writeText(t).then((function(){}),(function(e){console.log("text copy to the system clipboard error  ",t,e)}))}}},{key:"cut",value:function(){this.clipboard.cut(this.selector.range)}},{key:"paste",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},i=this.clipboard,r=this.selector;return!i.isClear()&&!!ft.call(this,i.range,r.range,n)&&(this.changeData((function(){i.isCopy()?dt.call(t,i.range,r.range,e):i.isCut()&&vt.call(t,i.range,r.range)})),!0)}},{key:"pasteFromText",value:function(t){var e=t.split("\r\n").map((function(t){return t.replace(/"/g,"").split("\t")}));e.length>0&&(e.length-=1);var n=this.rows,i=this.selector;this.changeData((function(){n.paste(e,i.range)}))}},{key:"autofill",value:function(t,e){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=this.selector.range;return!!ft.call(this,r,t,i)&&(this.changeData((function(){dt.call(n,r,t,e,!0)})),!0)}},{key:"clearClipboard",value:function(){this.clipboard.clear()}},{key:"calSelectedRangeByEnd",value:function(t,e){var n=this.selector,i=this.rows,r=this.cols,a=this.merges,o=n.range,l=o.sri,s=o.sci,c=o.eri,u=o.eci,h=n.ri,f=n.ci,d=t,v=e;return t<0&&(d=i.len-1),e<0&&(v=r.len-1),d>h?(l=h,c=d):(l=d,c=h),v>f?(s=f,u=v):(s=v,u=f),n.range=a.union(new b(l,s,c,u)),n.range=a.union(n.range),n.range}},{key:"calSelectedRangeByStart",value:function(t,e){var n=this.selector,i=this.rows,r=this.cols,a=this.merges.getFirstIncludes(t,e);return null===a&&(a=new b(t,e,t,e),-1===t&&(a.sri=0,a.eri=i.len-1),-1===e&&(a.sci=0,a.eci=r.len-1)),n.range=a,a}},{key:"setSelectedCellAttr",value:function(t,e){var n=this;this.changeData((function(){var i=n.selector,r=n.styles,a=n.rows;if("merge"===t)e?n.merge():n.unmerge();else if("border"===t)yt.call(n,e);else if("formula"===t){var o=i.ri,l=i.ci,s=i.range;if(i.multiple()){var c=ct(i.size(),2),u=c[0],h=c[1],f=s.sri,v=s.sci,p=s.eri,y=s.eci;if(u>1)for(var g=v;g<=y;g+=1)a.getCellOrNew(p+1,g).text="=".concat(e,"(").concat(d(g,f),":").concat(d(g,p),")");else h>1&&(a.getCellOrNew(o,y+1).text="=".concat(e,"(").concat(d(v,o),":").concat(d(y,o),")"))}else a.getCellOrNew(o,l).text="=".concat(e,"()")}else i.range.each((function(i,o){var l=a.getCellOrNew(i,o),s={};if(void 0!==l.style&&(s=F.cloneDeep(r[l.style])),"format"===t)s.format=e,l.style=n.addStyle(s);else if("font-bold"===t||"font-italic"===t||"font-name"===t||"font-size"===t){var c={};c[t.split("-")[1]]=e,s.font=Object.assign(s.font||{},c),l.style=n.addStyle(s)}else"strike"===t||"textwrap"===t||"underline"===t||"align"===t||"valign"===t||"color"===t||"bgcolor"===t?(s[t]=e,l.style=n.addStyle(s)):l[t]=e}))}))}},{key:"setSelectedCellText",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"input",n=this.autoFilter,i=this.selector,r=this.rows,a=i.ri,o=i.ci,l=a;this.unsortedRowMap.has(a)&&(l=this.unsortedRowMap.get(a));var s=r.getCell(l,o),c=s?s.text:"";if(this.setCellText(l,o,t,e),n.active()){var u=n.getFilter(o);if(u){var h=u.value.findIndex((function(t){return t===c}));h>=0&&u.value.splice(h,1,t)}}}},{key:"getSelectedCell",value:function(){var t=this.selector,e=t.ri,n=t.ci,i=e;return this.unsortedRowMap.has(e)&&(i=this.unsortedRowMap.get(e)),this.rows.getCell(i,n)}},{key:"xyInSelectedRect",value:function(t,e){var n=this.getSelectedRect(),i=n.left,r=n.top,a=n.width,o=n.height,l=t-this.cols.indexWidth,s=e-this.rows.height;return l>i&&l<i+a&&s>r&&s<r+o}},{key:"getSelectedRect",value:function(){return this.getRect(this.selector.range)}},{key:"getClipboardRect",value:function(){var t=this.clipboard;return t.isClear()?{left:-100,top:-100}:this.getRect(t.range)}},{key:"getRect",value:function(t){var e=this.scroll,n=this.rows,i=this.cols,r=this.exceptRowSet,a=t.sri,o=t.sci,l=t.eri,s=t.eci;if(a<0&&o<0)return{left:0,l:0,top:0,t:0,scroll:e};var c=i.sumWidth(0,o),u=n.sumHeight(0,a,r),h=n.sumHeight(a,l+1,r),f=i.sumWidth(o,s+1),d=c-e.x,v=u-e.y,p=this.freezeTotalHeight(),y=this.freezeTotalWidth();return y>0&&y>c&&(d=c),p>0&&p>u&&(v=u),{l:c,t:u,left:d,top:v,height:h,width:f,scroll:e}}},{key:"getCellRectByXY",value:function(t,e){var n=this.scroll,i=this.merges,r=this.rows,a=this.cols,o=gt.call(this,e,n.y),l=o.ri,s=o.top,c=o.height,u=bt.call(this,t,n.x),h=u.ci,f=u.left,d=u.width;if(-1===h&&(d=a.totalWidth()),-1===l&&(c=r.totalHeight()),l>=0||h>=0){var v=i.getFirstIncludes(l,h);if(v){l=v.sri,h=v.sci;var p=this.cellRect(l,h);f=p.left,s=p.top,d=p.width,c=p.height}}return{ri:l,ci:h,left:f,top:s,width:d,height:c}}},{key:"isSingleSelected",value:function(){var t=this.selector.range,e=t.sri,n=t.sci,i=t.eri,r=t.eci,a=this.getCell(e,n);if(a&&a.merge){var o=ct(a.merge,2),l=o[0],s=o[1];if(e+l===i&&n+s===r)return!0}return!this.selector.multiple()}},{key:"canUnmerge",value:function(){var t=this.selector.range,e=t.sri,n=t.sci,i=t.eri,r=t.eci,a=this.getCell(e,n);if(a&&a.merge){var o=ct(a.merge,2),l=o[0],s=o[1];if(e+l===i&&n+s===r)return!0}return!1}},{key:"merge",value:function(){var t=this,e=this.selector,n=this.rows;if(!this.isSingleSelected()){var i=ct(e.size(),2),r=i[0],a=i[1];if(r>1||a>1){var o=e.range,l=o.sri,s=o.sci;this.changeData((function(){var i=n.getCellOrNew(l,s);i.merge=[r-1,a-1],t.merges.add(e.range),t.rows.deleteCells(e.range),t.rows.setCell(l,s,i)}))}}}},{key:"unmerge",value:function(){var t=this,e=this.selector;if(this.isSingleSelected()){var n=e.range,i=n.sri,r=n.sci;this.changeData((function(){t.rows.deleteCell(i,r,"merge"),t.merges.deleteWithin(e.range)}))}}},{key:"canAutofilter",value:function(){return!this.autoFilter.active()}},{key:"autofilter",value:function(){var t=this,e=this.autoFilter,n=this.selector;this.changeData((function(){e.active()?(e.clear(),t.exceptRowSet=new Set,t.sortedRowMap=new Map,t.unsortedRowMap=new Map):e.ref=n.range.toString()}))}},{key:"setAutoFilter",value:function(t,e,n,i){var r=this.autoFilter;r.addFilter(t,n,i),r.setSort(t,e),this.resetAutoFilter()}},{key:"resetAutoFilter",value:function(){var t=this,e=this.autoFilter,n=this.rows;if(e.active()){var i=e.sort,r=e.filteredRows((function(t,e){return n.getCell(t,e)})),a=r.rset,o=r.fset,l=Array.from(o),s=Array.from(o);i&&l.sort((function(t,e){return"asc"===i.order?t-e:"desc"===i.order?e-t:0})),this.exceptRowSet=a,this.sortedRowMap=new Map,this.unsortedRowMap=new Map,l.forEach((function(e,n){t.sortedRowMap.set(s[n],e),t.unsortedRowMap.set(e,s[n])}))}}},{key:"deleteCell",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all",n=this.selector;this.changeData((function(){t.rows.deleteCells(n.range,e),"all"!==e&&"format"!==e||t.merges.deleteWithin(n.range)}))}},{key:"insert",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.changeData((function(){var i=e.selector.range,r=i.sri,a=i.sci,o=e.rows,l=e.merges,s=e.cols,c=r;"row"===t?o.insert(r,n):"column"===t&&(o.insertColumn(a,n),c=a,s.len+=1),l.shift(t,c,n,(function(t,e,n,i){var r=o.getCell(t,e);r.merge[0]+=n,r.merge[1]+=i}))}))}},{key:"delete",value:function(t){var e=this;this.changeData((function(){var n=e.rows,i=e.merges,r=e.selector,a=e.cols,o=r.range,l=r.range,s=l.sri,c=l.sci,u=l.eri,h=l.eci,f=ct(r.range.size(),2),d=f[0],v=f[1],p=s,y=d;"row"===t?n.delete(s,u):"column"===t&&(n.deleteColumn(c,h),p=o.sci,y=v,a.len-=h-c+1),i.shift(t,p,-y,(function(t,e,i,r){var a=n.getCell(t,e);a.merge[0]+=i,a.merge[1]+=r,0===a.merge[0]&&0===a.merge[1]&&delete a.merge}))}))}},{key:"scrollx",value:function(t,e){var n=this.scroll,i=this.freeze,r=this.cols,a=ct(i,2)[1],o=ct(F.rangeReduceIf(a,r.len,0,0,t,(function(t){return r.getWidth(t)})),3),l=o[0],s=o[1],c=o[2],u=s;t>0&&(u+=c),n.x!==u&&(n.ci=t>0?l:0,n.x=u,e())}},{key:"scrolly",value:function(t,e){var n=this.scroll,i=this.freeze,r=this.rows,a=ct(i,1)[0],o=ct(F.rangeReduceIf(a,r.len,0,0,t,(function(t){return r.getHeight(t)})),3),l=o[0],s=o[1],c=o[2],u=s;t>0&&(u+=c),n.y!==u&&(n.ri=t>0?l:0,n.y=u,e())}},{key:"cellRect",value:function(t,e){var n=this.rows,i=this.cols,r=i.sumWidth(0,e),a=n.sumHeight(0,t),o=n.getCell(t,e),l=i.getWidth(e),s=n.getHeight(t);if(null!==o&&o.merge){var c=ct(o.merge,2),u=c[0],h=c[1];if(u>0)for(var f=1;f<=u;f+=1)s+=n.getHeight(t+f);if(h>0)for(var d=1;d<=h;d+=1)l+=i.getWidth(e+d)}return{left:r,top:a,width:l,height:s,cell:o}}},{key:"getCell",value:function(t,e){return this.rows.getCell(t,e)}},{key:"getCellTextOrDefault",value:function(t,e){var n=this.getCell(t,e);return n&&n.text?n.text:""}},{key:"getCellStyle",value:function(t,e){var n=this.getCell(t,e);return n&&void 0!==n.style?this.styles[n.style]:null}},{key:"getCellStyleOrDefault",value:function(t,e){var n=this.styles,i=this.rows.getCell(t,e),r=i&&void 0!==i.style?n[i.style]:{};return F.merge(this.defaultStyle(),r)}},{key:"getSelectedCellStyle",value:function(){var t=this.selector,e=t.ri,n=t.ci;return this.getCellStyleOrDefault(e,n)}},{key:"setCellText",value:function(t,e,n,i){var r=this.rows,a=this.history,o=this.validations;"finished"===i?(r.setCellText(t,e,""),a.add(this.getData()),r.setCellText(t,e,n)):(r.setCellText(t,e,n),this.change(this.getData())),o.validate(t,e,n)}},{key:"freezeIsActive",value:function(){var t=ct(this.freeze,2),e=t[0],n=t[1];return e>0||n>0}},{key:"setFreeze",value:function(t,e){var n=this;this.changeData((function(){n.freeze=[t,e]}))}},{key:"freezeTotalWidth",value:function(){return this.cols.sumWidth(0,this.freeze[1])}},{key:"freezeTotalHeight",value:function(){return this.rows.sumHeight(0,this.freeze[0])}},{key:"setRowHeight",value:function(t,e){var n=this;this.changeData((function(){n.rows.setHeight(t,e)}))}},{key:"setColWidth",value:function(t,e){var n=this;this.changeData((function(){n.cols.setWidth(t,e)}))}},{key:"viewHeight",value:function(){var t=this.settings,e=t.view,n=t.showToolbar,i=t.showBottomBar,r=e.height();return i&&(r-=41),n&&(r-=41),r}},{key:"viewWidth",value:function(){return this.settings.view.width()}},{key:"freezeViewRange",value:function(){var t=ct(this.freeze,2),e=t[0],n=t[1];return new b(0,0,e-1,n-1,this.freezeTotalWidth(),this.freezeTotalHeight())}},{key:"contentRange",value:function(){var t=this.rows,e=this.cols,n=ct(t.maxCell(),2),i=n[0],r=n[1],a=t.sumHeight(0,i+1),o=e.sumWidth(0,r+1);return new b(0,0,i,r,o,a)}},{key:"exceptRowTotalHeight",value:function(t,e){var n=this.exceptRowSet,i=this.rows,r=Array.from(n),a=0;return r.forEach((function(n){if(n<t||n>e){var r=i.getHeight(n);a+=r}})),a}},{key:"viewRange",value:function(){var t=this.scroll,e=this.rows,n=this.cols,i=this.freeze,r=this.exceptRowSet,a=t.ri,o=t.ci;a<=0&&(a=ct(i,1)[0]),o<=0&&(o=ct(i,2)[1]);for(var l=0,s=0,c=[e.len,n.len],u=c[0],h=c[1],f=a;f<e.len&&(r.has(f)||(s+=e.getHeight(f),u=f),!(s>this.viewHeight()));f+=1);for(var d=o;d<n.len&&(h=d,!((l+=n.getWidth(d))>this.viewWidth()));d+=1);return new b(a,o,u,h,l,s)}},{key:"eachMergesInView",value:function(t,e){this.merges.filterIntersects(t).forEach((function(t){return e(t)}))}},{key:"hideRowsOrCols",value:function(){var t=this.rows,e=this.cols,n=this.selector,i=ct(n.size(),2),r=i[0],a=i[1],o=n.range,l=o.sri,s=o.sci,c=o.eri,u=o.eci;if(r===t.len)for(var h=s;h<=u;h+=1)e.setHide(h,!0);else if(a===e.len)for(var f=l;f<=c;f+=1)t.setHide(f,!0)}},{key:"unhideRowsOrCols",value:function(t,e){this["".concat(t,"s")].unhide(e)}},{key:"rowEach",value:function(t,e,n){for(var i=0,r=this.rows,a=this.exceptRowSet,o=lt(a),l=0,s=0;s<o.length;s+=1)o[s]<t&&(l+=1);for(var c=t+l;c<=e+l;c+=1)if(a.has(c))l+=1;else{var u=r.getHeight(c);if(u>0&&(n(c,i,u),(i+=u)>this.viewHeight()))break}}},{key:"colEach",value:function(t,e,n){for(var i=0,r=this.cols,a=t;a<=e;a+=1){var o=r.getWidth(a);if(o>0&&(n(a,i,o),(i+=o)>this.viewWidth()))break}}},{key:"defaultStyle",value:function(){return this.settings.style}},{key:"addStyle",value:function(t){for(var e=this.styles,n=0;n<e.length;n+=1){var i=e[n];if(F.equals(i,t))return n}return e.push(t),e.length-1}},{key:"changeData",value:function(t){this.history.add(this.getData()),t(),this.change(this.getData())}},{key:"setData",value:function(t){var e=this;return Object.keys(t).forEach((function(n){if("merges"===n||"rows"===n||"cols"===n||"validations"===n)e[n].setData(t[n]);else if("freeze"===n){var i=ct(f(t[n]),2),r=i[0],a=i[1];e.freeze=[a,r]}else"autofilter"===n?e.autoFilter.setData(t[n]):void 0!==t[n]&&(e[n]=t[n])})),this}},{key:"getData",value:function(){var t=this.name,e=this.freeze,n=this.styles,i=this.merges,r=this.rows,a=this.cols,o=this.validations,l=this.autoFilter;return{name:t,freeze:d(e[1],e[0]),styles:n,merges:i.getData(),rows:r.getData(),cols:a.getData(),validations:o.getData(),autofilter:l.getData()}}}])&&st(e.prototype,n),i&&st(e,i),t}();function wt(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function kt(t,e,n){t.addEventListener(e,n)}function xt(t,e,n){t.removeEventListener(e,n)}function Ot(t){t.xclickoutside&&(xt(window.document.body,"click",t.xclickoutside),delete t.xclickoutside)}function Et(t,e){t.xclickoutside=function(n){2===n.detail||t.contains(n.target)||(e?e(t):(t.hide(),Ot(t)))},kt(window.document.body,"click",t.xclickoutside)}function Ct(t,e,n){kt(t,"mousemove",e),t.xEvtUp=function(i){xt(t,"mousemove",e),xt(t,"mouseup",t.xEvtUp),n(i)},kt(t,"mouseup",t.xEvtUp)}function St(t,e,n,i){Math.abs(t)>Math.abs(e)?i(t>0?"right":"left",t,n):i(e>0?"down":"up",e,n)}var At="x-spreadsheet";window.devicePixelRatio;function Tt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function jt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Dt=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1?arguments[1]:void 0;Tt(this,t),this.moving=!1,this.vertical=n,this.el=l("div","".concat(At,"-resizer ").concat(n?"vertical":"horizontal")).children(this.unhideHoverEl=l("div","".concat(At,"-resizer-hover")).on("dblclick.stop",(function(t){return e.mousedblclickHandler(t)})).css("position","absolute").hide(),this.hoverEl=l("div","".concat(At,"-resizer-hover")).on("mousedown.stop",(function(t){return e.mousedownHandler(t)})),this.lineEl=l("div","".concat(At,"-resizer-line")).hide()).hide(),this.cRect=null,this.finishedFn=null,this.minDistance=i,this.unhideFn=function(){}}var e,n,i;return e=t,(n=[{key:"showUnhide",value:function(t){this.unhideIndex=t,this.unhideHoverEl.show()}},{key:"hideUnhide",value:function(){this.unhideHoverEl.hide()}},{key:"show",value:function(t,e){var n=this.moving,i=this.vertical,r=this.hoverEl,a=this.lineEl,o=this.el,l=this.unhideHoverEl;if(!n){this.cRect=t;var s=t.left,c=t.top,u=t.width,h=t.height;o.offset({left:i?s+u-5:s,top:i?c:c+h-5}).show(),r.offset({width:i?5:u,height:i?h:5}),a.offset({width:i?0:e.width,height:i?e.height:0}),l.offset({left:i?5-u:s,top:i?c:5-h,width:i?5:u,height:i?h:5})}}},{key:"hide",value:function(){this.el.offset({left:0,top:0}).hide(),this.hideUnhide()}},{key:"mousedblclickHandler",value:function(){this.unhideIndex&&this.unhideFn(this.unhideIndex)}},{key:"mousedownHandler",value:function(t){var e=this,n=t,i=this.el,r=this.lineEl,a=this.cRect,o=this.vertical,l=this.minDistance,s=o?a.width:a.height;r.show(),Ct(window,(function(t){e.moving=!0,null!==n&&1===t.buttons&&(o?(s+=t.movementX)>l&&i.css("left","".concat(a.left+s,"px")):(s+=t.movementY)>l&&i.css("top","".concat(a.top+s,"px")),n=t)}),(function(){n=null,r.hide(),e.moving=!1,e.hide(),e.finishedFn&&(s<l&&(s=l),e.finishedFn(a,s))}))}}])&&jt(e.prototype,n),i&&jt(e,i),t}();function It(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Rt=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.vertical=e,this.moveFn=null,this.el=l("div","".concat(At,"-scrollbar ").concat(e?"vertical":"horizontal")).child(this.contentEl=l("div","")).on("mousemove.stop",(function(){})).on("scroll.stop",(function(t){var e=t.target,i=e.scrollTop,r=e.scrollLeft;n.moveFn&&n.moveFn(n.vertical?i:r,t)}))}var e,n,i;return e=t,(n=[{key:"move",value:function(t){return this.el.scroll(t),this}},{key:"scroll",value:function(){return this.el.scroll()}},{key:"set",value:function(t,e){var n=t-1;if(e>n){var i=this.vertical?"height":"width";this.el.css(i,"".concat(n-15,"px")).show(),this.contentEl.css(this.vertical?"width":"height","1px").css(i,"".concat(e,"px"))}else this.el.hide();return this}}])&&It(e.prototype,n),i&&It(e,i),t}();function Pt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function zt(t,e,n){return e&&_t(t.prototype,e),n&&_t(t,n),t}var Ht=10,Mt=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Pt(this,t),this.useHideInput=n,this.inputChange=function(){},this.cornerEl=l("div","".concat(At,"-selector-corner")),this.areaEl=l("div","".concat(At,"-selector-area")).child(this.cornerEl).hide(),this.clipboardEl=l("div","".concat(At,"-selector-clipboard")).hide(),this.autofillEl=l("div","".concat(At,"-selector-autofill")).hide(),this.el=l("div","".concat(At,"-selector")).css("z-index","".concat(Ht)).children(this.areaEl,this.clipboardEl,this.autofillEl).hide(),n&&(this.hideInput=l("input","").on("compositionend",(function(t){e.inputChange(t.target.value)})),this.el.child(this.hideInputDiv=l("div","hide-input").child(this.hideInput)),this.el.child(this.hideInputDiv=l("div","hide-input").child(this.hideInput))),Ht+=1}return zt(t,[{key:"setOffset",value:function(t){return this.el.offset(t).show(),this}},{key:"hide",value:function(){return this.el.hide(),this}},{key:"setAreaOffset",value:function(t){var e=t.left,n=t.top,i={width:t.width-3+.8,height:t.height-3+.8,left:e-.8,top:n-.8};this.areaEl.offset(i).show(),this.useHideInput&&(this.hideInputDiv.offset(i),this.hideInput.val("").focus())}},{key:"setClipboardOffset",value:function(t){var e=t.left,n=t.top,i=t.width,r=t.height;this.clipboardEl.offset({left:e,top:n,width:i-5,height:r-5})}},{key:"showAutofill",value:function(t){var e=t.left,n=t.top,i=t.width,r=t.height;this.autofillEl.offset({width:i-3,height:r-3,left:e,top:n}).show()}},{key:"hideAutofill",value:function(){this.autofillEl.hide()}},{key:"showClipboard",value:function(){this.clipboardEl.show()}},{key:"hideClipboard",value:function(){this.clipboardEl.hide()}}]),t}();function Ft(t){var e=this.data,n=t.left,i=t.top,r=t.width,a=t.height,o=t.scroll,l=t.l,s=t.t,c=e.freezeTotalWidth(),u=e.freezeTotalHeight(),h=n-c;c>l&&(h-=o.x);var f=i-u;return u>s&&(f-=o.y),{left:h,top:f,width:r,height:a}}function Nt(t){var e=this.data,n=t.left,i=t.width,r=t.height,a=t.l,o=t.t,l=t.scroll,s=e.freezeTotalWidth(),c=n-s;return s>a&&(c-=l.x),{left:c,top:o,width:i,height:r}}function Wt(t){var e=this.data,n=t.top,i=t.width,r=t.height,a=t.l,o=t.t,l=t.scroll,s=e.freezeTotalHeight(),c=n-s;return s>o&&(c-=l.y),{left:a,top:c,width:i,height:r}}function Vt(t){this.br.setAreaOffset(Ft.call(this,t))}function qt(t){this.tl.setAreaOffset(t)}function Bt(t){this.t.setAreaOffset(Nt.call(this,t))}function Lt(t){this.l.setAreaOffset(Wt.call(this,t))}function Ut(t){this.l.setClipboardOffset(Wt.call(this,t))}function Yt(t){this.br.setClipboardOffset(Ft.call(this,t))}function $t(t){this.tl.setClipboardOffset(t)}function Xt(t){this.t.setClipboardOffset(Nt.call(this,t))}function Zt(t){Vt.call(this,t),qt.call(this,t),Bt.call(this,t),Lt.call(this,t)}function Kt(t){Yt.call(this,t),$t.call(this,t),Xt.call(this,t),Ut.call(this,t)}var Jt=function(){function t(e){var n=this;Pt(this,t),this.inputChange=function(){},this.data=e,this.br=new Mt(!0),this.t=new Mt,this.l=new Mt,this.tl=new Mt,this.br.inputChange=function(t){n.inputChange(t)},this.br.el.show(),this.offset=null,this.areaOffset=null,this.indexes=null,this.range=null,this.arange=null,this.el=l("div","".concat(At,"-selectors")).children(this.tl.el,this.t.el,this.l.el,this.br.el).hide(),this.lastri=-1,this.lastci=-1,Ht+=1}return zt(t,[{key:"resetData",value:function(t){this.data=t,this.range=t.selector.range,this.resetAreaOffset()}},{key:"hide",value:function(){this.el.hide()}},{key:"resetOffset",value:function(){var t=this.data,e=this.tl,n=this.t,i=this.l,r=this.br,a=t.freezeTotalHeight(),o=t.freezeTotalWidth();a>0||o>0?(e.setOffset({width:o,height:a}),n.setOffset({left:o,height:a}),i.setOffset({top:a,width:o}),r.setOffset({left:o,top:a})):(e.hide(),n.hide(),i.hide(),r.setOffset({left:0,top:0}))}},{key:"resetAreaOffset",value:function(){var t=this.data.getSelectedRect(),e=this.data.getClipboardRect();Zt.call(this,t),Kt.call(this,e),this.resetOffset()}},{key:"resetBRTAreaOffset",value:function(){var t=this.data.getSelectedRect(),e=this.data.getClipboardRect();Vt.call(this,t),Bt.call(this,t),Yt.call(this,e),Xt.call(this,e),this.resetOffset()}},{key:"resetBRLAreaOffset",value:function(){var t=this.data.getSelectedRect(),e=this.data.getClipboardRect();Vt.call(this,t),Lt.call(this,t),Yt.call(this,e),Ut.call(this,e),this.resetOffset()}},{key:"set",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this.data,r=i.calSelectedRangeByStart(t,e),a=r.sri,o=r.sci;if(n){var l=t,s=e;t<0&&(l=0),e<0&&(s=0),i.selector.setIndexes(l,s),this.indexes=[l,s]}this.moveIndexes=[a,o],this.range=r,this.resetAreaOffset(),this.el.show()}},{key:"setEnd",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this.data,r=this.lastri,a=this.lastci;if(n){if(t===r&&e===a)return;this.lastri=t,this.lastci=e}this.range=i.calSelectedRangeByEnd(t,e),Zt.call(this,this.data.getSelectedRect())}},{key:"reset",value:function(){var t=this.data.selector.range,e=t.eri,n=t.eci;this.setEnd(e,n)}},{key:"showAutofill",value:function(t,e){if(-1!==t||-1!==e){var n=this.range,i=n.sri,r=n.sci,a=n.eri,o=n.eci,l=t,s=e,c=i-t,u=a-t,h=o-e;if(r-e>0)this.arange=new b(i,s,a,r-1);else if(c>0)this.arange=new b(l,r,i-1,o);else if(h<0)this.arange=new b(i,o+1,a,s);else{if(!(u<0))return void(this.arange=null);this.arange=new b(a+1,r,l,o)}if(null!==this.arange){var f=this.data.getRect(this.arange);f.width+=2,f.height+=2;var d=this.br,v=this.l,p=this.t,y=this.tl;d.showAutofill(Ft.call(this,f)),v.showAutofill(Wt.call(this,f)),p.showAutofill(Nt.call(this,f)),y.showAutofill(f)}}}},{key:"hideAutofill",value:function(){var t=this;["br","l","t","tl"].forEach((function(e){t[e].hideAutofill()}))}},{key:"showClipboard",value:function(){var t=this,e=this.data.getClipboardRect();Kt.call(this,e),["br","l","t","tl"].forEach((function(e){t[e].showClipboard()}))}},{key:"hideClipboard",value:function(){var t=this;["br","l","t","tl"].forEach((function(e){t[e].hideClipboard()}))}}]),t}();function Gt(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Qt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function te(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ee(t){t.preventDefault(),t.stopPropagation();var e=this.filterItems;e.length<=0||(this.itemIndex>=0&&e[this.itemIndex].toggle(),this.itemIndex-=1,this.itemIndex<0&&(this.itemIndex=e.length-1),e[this.itemIndex].toggle())}function ne(t){t.stopPropagation();var e=this.filterItems;e.length<=0||(this.itemIndex>=0&&e[this.itemIndex].toggle(),this.itemIndex+=1,this.itemIndex>e.length-1&&(this.itemIndex=0),e[this.itemIndex].toggle())}function ie(t){t.preventDefault();var e=this.filterItems;e.length<=0||(t.stopPropagation(),this.itemIndex<0&&(this.itemIndex=0),e[this.itemIndex].el.click(),this.hide())}function re(t){var e=t.keyCode;switch(t.ctrlKey&&t.stopPropagation(),e){case 37:t.stopPropagation();break;case 38:ee.call(this,t);break;case 39:t.stopPropagation();break;case 40:ne.call(this,t);break;case 13:case 9:ie.call(this,t);break;default:t.stopPropagation()}}var ae=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"200px";Qt(this,t),this.filterItems=[],this.items=e,this.el=l("div","".concat(At,"-suggest")).css("width",i).hide(),this.itemClick=n,this.itemIndex=-1}var e,n,i;return e=t,(n=[{key:"setOffset",value:function(t){this.el.cssRemoveKeys("top","bottom").offset(t)}},{key:"hide",value:function(){var t=this.el;this.filterItems=[],this.itemIndex=-1,t.hide(),Ot(this.el.parent())}},{key:"setItems",value:function(t){this.items=t}},{key:"search",value:function(t){var e,n=this,i=this.items;if(/^\s*$/.test(t)||(i=i.filter((function(e){return(e.key||e).startsWith(t.toUpperCase())}))),i=i.map((function(t){var e=t.title;e?"function"==typeof e&&(e=e()):e=t;var i=l("div","".concat(At,"-item")).child(e).on("click.stop",(function(){n.itemClick(t),n.hide()}));return t.label&&i.child(l("div","label").html(t.label)),i})),this.filterItems=i,!(i.length<=0)){var r=this.el;(e=r.html("")).children.apply(e,Gt(i)).show(),Et(r.parent(),(function(){n.hide()}))}}},{key:"bindInputEvents",value:function(t){var e=this;t.on("keydown",(function(t){return re.call(e,t)}))}}])&&te(e.prototype,n),i&&te(e,i),t}();function oe(t){return(oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function le(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function se(t,e){return!e||"object"!==oe(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ce(t){return(ce=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ue(t,e){return(ue=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var he=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=se(this,ce(e).call(this,"div","".concat(At,"-icon")))).iconNameEl=l("div","".concat(At,"-icon-img ").concat(t)),n.child(n.iconNameEl),n}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ue(t,e)}(e,t),n=e,(i=[{key:"setName",value:function(t){this.iconNameEl.className("".concat(At,"-icon-img ").concat(t))}}])&&le(n.prototype,i),r&&le(n,r),e}(o);function fe(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function de(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ve(t,e){t.setMonth(t.getMonth()+e)}function pe(t,e){var n=new Date(t);return n.setDate(e-t.getDay()+1),n}var ye=function(){function t(e){var n,i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.value=e,this.cvalue=new Date(e),this.headerLeftEl=l("div","calendar-header-left"),this.bodyEl=l("tbody",""),this.buildAll(),this.el=l("div","x-spreadsheet-calendar").children(l("div","calendar-header").children(this.headerLeftEl,l("div","calendar-header-right").children(l("a","calendar-prev").on("click.stop",(function(){return i.prev()})).child(new he("chevron-left")),l("a","calendar-next").on("click.stop",(function(){return i.next()})).child(new he("chevron-right")))),l("table","calendar-body").children(l("thead","").child((n=l("tr","")).children.apply(n,fe($("calendar.weeks").map((function(t){return l("th","cell").child(t)}))))),this.bodyEl)),this.selectChange=function(){}}var e,n,i;return e=t,(n=[{key:"setValue",value:function(t){this.value=t,this.cvalue=new Date(t),this.buildAll()}},{key:"prev",value:function(){ve(this.value,-1),this.buildAll()}},{key:"next",value:function(){ve(this.value,1),this.buildAll()}},{key:"buildAll",value:function(){this.buildHeaderLeft(),this.buildBody()}},{key:"buildHeaderLeft",value:function(){var t=this.value;this.headerLeftEl.html("".concat($("calendar.months")[t.getMonth()]," ").concat(t.getFullYear()))}},{key:"buildBody",value:function(){var t,e=this,n=this.value,i=this.cvalue,r=this.bodyEl,a=function(t,e,n){for(var i=new Date(t,e,1,23,59,59),r=[[],[],[],[],[],[]],a=0;a<6;a+=1)for(var o=0;o<7;o+=1){var l=pe(i,7*a+o),s=l.getMonth()!==e,c=l.getMonth()===n.getMonth()&&l.getDate()===n.getDate();r[a][o]={d:l,disabled:s,active:c}}return r}(n.getFullYear(),n.getMonth(),i).map((function(t){var n,i=t.map((function(t){var n="cell";return t.disabled&&(n+=" disabled"),t.active&&(n+=" active"),l("td","").child(l("div",n).on("click.stop",(function(){e.selectChange(t.d)})).child(t.d.getDate().toString()))}));return(n=l("tr","")).children.apply(n,fe(i))}));(t=r.html("")).children.apply(t,fe(a))}}])&&de(e.prototype,n),i&&de(e,i),t}();function ge(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var be=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.calendar=new ye(new Date),this.el=l("div","".concat(At,"-datepicker")).child(this.calendar.el).hide()}var e,n,i;return e=t,(n=[{key:"setValue",value:function(t){var e=this.calendar;return"string"==typeof t?/^\d{4}-\d{1,2}-\d{1,2}$/.test(t)&&e.setValue(new Date(t.replace(new RegExp("-","g"),"/"))):t instanceof Date&&e.setValue(t),this}},{key:"change",value:function(t){var e=this;this.calendar.selectChange=function(n){t(n),e.hide()}}},{key:"show",value:function(){this.el.show()}},{key:"hide",value:function(){this.el.hide()}}])&&ge(e.prototype,n),i&&ge(e,i),t}();function me(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function we(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ke(){var t=this.inputText;if(!/^\s*$/.test(t)){var e=this.textlineEl,n=this.textEl,i=this.areaOffset,r=t.split("\n"),a=Math.max.apply(Math,we(r.map((function(t){return t.length})))),o=e.offset().width/t.length,l=(a+1)*o+5,s=this.viewFn().width-i.left-o,c=r.length;if(l>i.width){var u=l;l>s&&(u=s,c+=parseInt(l/s,10),c+=l%s>0?1:0),n.css("width","".concat(u,"px"))}(c*=this.rowHeight)>i.height&&n.css("height","".concat(c,"px"))}}function xe(t,e){var n=t.target,i=n.value,r=n.selectionEnd,a="".concat(i.slice(0,r)).concat(e).concat(i.slice(r));n.value=a,n.setSelectionRange(r+1,r+1),this.inputText=a,this.textlineEl.html(a),ke.call(this)}function Oe(t){var e=t.keyCode,n=t.altKey;13!==e&&9!==e&&t.stopPropagation(),13===e&&n&&(xe.call(this,t,"\n"),t.stopPropagation()),13!==e||n||t.preventDefault()}function Ee(t){var e=t.target.value,n=this.suggest,i=this.textlineEl,r=this.validator,a=this.cell;if(null!==a)if("editable"in a&&!0===a.editable||void 0===a.editable){if(this.inputText=e,r)"list"===r.type?n.search(e):n.hide();else{var o=e.lastIndexOf("=");-1!==o?n.search(e.substring(o+1)):n.hide()}i.html(e),ke.call(this),this.change("input",e)}else t.target.value=a.text;else{if(this.inputText=e,r)"list"===r.type?n.search(e):n.hide();else{var l=e.lastIndexOf("=");-1!==l?n.search(e.substring(l+1)):n.hide()}i.html(e),ke.call(this),this.change("input",e)}}function Ce(t){var e=this.textEl.el;setTimeout((function(){e.focus(),e.setSelectionRange(t,t)}),0)}function Se(t,e){var n=this.textEl,i=this.textlineEl;n.el.blur(),n.val(t),i.html(t),Ce.call(this,e)}function Ae(t){var e=this.inputText,n=this.validator,i=0;if(n&&"list"===n.type)this.inputText=t,i=this.inputText.length;else{var r=e.lastIndexOf("="),a=e.substring(0,r+1),o=e.substring(r+1);o=-1!==o.indexOf(")")?o.substring(o.indexOf(")")):"",this.inputText="".concat(a+t.key,"("),i=this.inputText.length,this.inputText+=")".concat(o)}Se.call(this,this.inputText,i)}function Te(){this.suggest.setItems(this.formulas)}var je=function(){function t(e,n,i){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.viewFn=n,this.rowHeight=i,this.formulas=e,this.suggest=new ae(e,(function(t){Ae.call(r,t)})),this.datepicker=new be,this.datepicker.change((function(t){r.setText(function(t){var e=t.getMonth()+1,n=t.getDate();return e<10&&(e="0".concat(e)),n<10&&(n="0".concat(n)),"".concat(t.getFullYear(),"-").concat(e,"-").concat(n)}(t)),r.clear()})),this.areaEl=l("div","".concat(At,"-editor-area")).children(this.textEl=l("textarea","").on("input",(function(t){return Ee.call(r,t)})).on("paste.stop",(function(){})).on("keydown",(function(t){return Oe.call(r,t)})),this.textlineEl=l("div","textline"),this.suggest.el,this.datepicker.el).on("mousemove.stop",(function(){})).on("mousedown.stop",(function(){})),this.el=l("div","".concat(At,"-editor")).child(this.areaEl).hide(),this.suggest.bindInputEvents(this.textEl),this.areaOffset=null,this.freeze={w:0,h:0},this.cell=null,this.inputText="",this.change=function(){}}var e,n,i;return e=t,(n=[{key:"setFreezeLengths",value:function(t,e){this.freeze.w=t,this.freeze.h=e}},{key:"clear",value:function(){""!==this.inputText&&this.change("finished",this.inputText),this.cell=null,this.areaOffset=null,this.inputText="",this.el.hide(),this.textEl.val(""),this.textlineEl.html(""),Te.call(this),this.datepicker.hide()}},{key:"setOffset",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"top",n=this.textEl,i=this.areaEl,r=this.suggest,a=this.freeze,o=this.el;if(t){this.areaOffset=t;var l=t.left,s=t.top,c=t.width,u=t.height,h=t.l,f=t.t,d={left:0,top:0};a.w>h&&a.h>f||(a.w<h&&a.h<f?(d.left=a.w,d.top=a.h):a.w>h?d.top=a.h:a.h>f&&(d.left=a.w)),o.offset(d),i.offset({left:l-d.left-.8,top:s-d.top-.8}),n.offset({width:c-9+.8,height:u-3+.8});var v={left:0};v[e]=u,r.setOffset(v),r.hide()}}},{key:"setCell",value:function(t,e){var n=this.el,i=this.datepicker,r=this.suggest;n.show(),this.cell=t;var a=t&&t.text||"";if(this.setText(a),this.validator=e,e){var o=e.type;"date"===o&&(i.show(),/^\s*$/.test(a)||i.setValue(a)),"list"===o&&(r.setItems(e.values()),r.search(""))}}},{key:"setText",value:function(t){this.inputText=t,Se.call(this,t,t.length),ke.call(this)}}])&&me(e.prototype,n),i&&me(e,i),t}();function De(t){return(De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ie(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Re(t,e){return!e||"object"!==De(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Pe(t){return(Pe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _e(t,e){return(_e=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ze=function(t){function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Ie(this,e),(n=Re(this,Pe(e).call(this,"div","".concat(At,"-button ").concat(i)))).child($("button.".concat(t))),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_e(t,e)}(e,t),e}(o);function He(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Me(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(i=(o=l.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{i||null==l.return||l.return()}finally{if(r)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Fe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ne(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function We(t,e,n){return e&&Ne(t.prototype,e),n&&Ne(t,n),t}function Ve(){return window.devicePixelRatio||1}function qe(){return Ve()-.5}function Be(t){return parseInt(t*Ve(),10)}function Le(t){var e=Be(t);return e>0?e-.5:.5}var Ue=function(){function t(e,n,i,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;Fe(this,t),this.x=e,this.y=n,this.width=i,this.height=r,this.padding=a,this.bgcolor="#ffffff",this.borderTop=null,this.borderRight=null,this.borderBottom=null,this.borderLeft=null}return We(t,[{key:"setBorders",value:function(t){var e=t.top,n=t.bottom,i=t.left,r=t.right;e&&(this.borderTop=e),r&&(this.borderRight=r),n&&(this.borderBottom=n),i&&(this.borderLeft=i)}},{key:"innerWidth",value:function(){return this.width-2*this.padding-2}},{key:"innerHeight",value:function(){return this.height-2*this.padding-2}},{key:"textx",value:function(t){var e=this.width,n=this.padding,i=this.x;return"left"===t?i+=n:"center"===t?i+=e/2:"right"===t&&(i+=e-n),i}},{key:"texty",value:function(t,e){var n=this.height,i=this.padding,r=this.y;return"top"===t?r+=i:"middle"===t?r+=n/2-e/2:"bottom"===t&&(r+=n-i-e),r}},{key:"topxys",value:function(){var t=this.x,e=this.y;return[[t,e],[t+this.width,e]]}},{key:"rightxys",value:function(){var t=this.x,e=this.y,n=this.width;return[[t+n,e],[t+n,e+this.height]]}},{key:"bottomxys",value:function(){var t=this.x,e=this.y,n=this.width,i=this.height;return[[t,e+i],[t+n,e+i]]}},{key:"leftxys",value:function(){var t=this.x,e=this.y;return[[t,e],[t,e+this.height]]}}]),t}();function Ye(t,e,n,i,r,a,o){var l={x:0,y:0};"underline"===t?l.y="bottom"===r?0:"top"===r?-(a+2):-a/2:"strike"===t&&("bottom"===r?l.y=a/2:"top"===r&&(l.y=-(a/2+2))),"center"===i?l.x=o/2:"right"===i&&(l.x=o),this.line([e-l.x,n-l.y],[e-l.x+o,n-l.y])}var $e=function(){function t(e,n,i){Fe(this,t),this.el=e,this.ctx=e.getContext("2d"),this.resize(n,i),this.ctx.scale(Ve(),Ve())}return We(t,[{key:"resize",value:function(t,e){this.el.style.width="".concat(t,"px"),this.el.style.height="".concat(e,"px"),this.el.width=Be(t),this.el.height=Be(e)}},{key:"clear",value:function(){var t=this.el,e=t.width,n=t.height;return this.ctx.clearRect(0,0,e,n),this}},{key:"attr",value:function(t){return Object.assign(this.ctx,t),this}},{key:"save",value:function(){return this.ctx.save(),this.ctx.beginPath(),this}},{key:"restore",value:function(){return this.ctx.restore(),this}},{key:"beginPath",value:function(){return this.ctx.beginPath(),this}},{key:"translate",value:function(t,e){return this.ctx.translate(Be(t),Be(e)),this}},{key:"scale",value:function(t,e){return this.ctx.scale(t,e),this}},{key:"clearRect",value:function(t,e,n,i){return this.ctx.clearRect(t,e,n,i),this}},{key:"fillRect",value:function(t,e,n,i){return this.ctx.fillRect(Be(t)-.5,Be(e)-.5,Be(n),Be(i)),this}},{key:"fillText",value:function(t,e,n){return this.ctx.fillText(t,Be(e),Be(n)),this}},{key:"text",value:function(t,e){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=this.ctx,o=i.align,l=i.valign,s=i.font,c=i.color,u=i.strike,h=i.underline,f=e.textx(o);a.save(),a.beginPath(),this.attr({textAlign:o,textBaseline:l,font:"".concat(s.italic?"italic":""," ").concat(s.bold?"bold":""," ").concat(Be(s.size),"px ").concat(s.name),fillStyle:c,strokeStyle:c});var d="".concat(t).split("\n"),v=e.innerWidth(),p=[];d.forEach((function(t){var e=a.measureText(t).width;if(r&&e>Be(v)){for(var n={w:0,len:0,start:0},i=0;i<t.length;i+=1)n.w>=Be(v)&&(p.push(t.substr(n.start,n.len)),n={w:0,len:0,start:i}),n.len+=1,n.w+=a.measureText(t[i]).width+1;n.len>0&&p.push(t.substr(n.start,n.len))}else p.push(t)}));var y=(p.length-1)*(s.size+2),g=e.texty(l,y);return p.forEach((function(t){var e=a.measureText(t).width;n.fillText(t,f,g),u&&Ye.call(n,"strike",f,g,o,l,s.size,e),h&&Ye.call(n,"underline",f,g,o,l,s.size,e),g+=s.size+2})),a.restore(),this}},{key:"border",value:function(t,e){var n=this.ctx;return n.lineWidth=qe,n.strokeStyle=e,"medium"===t?n.lineWidth=Be(2)-.5:"thick"===t?n.lineWidth=Be(3):"dashed"===t?n.setLineDash([Be(3),Be(2)]):"dotted"===t?n.setLineDash([Be(1),Be(1)]):"double"===t&&n.setLineDash([Be(2),0]),this}},{key:"line",value:function(){var t=this.ctx;if(arguments.length>1){t.beginPath();var e=arguments.length<=0?void 0:arguments[0],n=Me(e,2),i=n[0],r=n[1];t.moveTo(Le(i),Le(r));for(var a=1;a<arguments.length;a+=1){var o=a<0||arguments.length<=a?void 0:arguments[a],l=Me(o,2),s=l[0],c=l[1];t.lineTo(Le(s),Le(c))}t.stroke()}return this}},{key:"strokeBorders",value:function(t){var e=this.ctx;e.save();var n=t.borderTop,i=t.borderRight,r=t.borderBottom,a=t.borderLeft;n&&(this.border.apply(this,He(n)),this.line.apply(this,He(t.topxys()))),i&&(this.border.apply(this,He(i)),this.line.apply(this,He(t.rightxys()))),r&&(this.border.apply(this,He(r)),this.line.apply(this,He(t.bottomxys()))),a&&(this.border.apply(this,He(a)),this.line.apply(this,He(t.leftxys()))),e.restore()}},{key:"dropdown",value:function(t){var e=this.ctx,n=t.x,i=t.y,r=n+t.width-15,a=i+t.height-15;e.save(),e.beginPath(),e.moveTo(Be(r),Be(a)),e.lineTo(Be(r+8),Be(a)),e.lineTo(Be(r+4),Be(a+6)),e.closePath(),e.fillStyle="rgba(0, 0, 0, .45)",e.fill(),e.restore()}},{key:"error",value:function(t){var e=this.ctx,n=t.x,i=t.y,r=n+t.width-1;e.save(),e.beginPath(),e.moveTo(Be(r-8),Be(i-1)),e.lineTo(Be(r),Be(i-1)),e.lineTo(Be(r),Be(i+8)),e.closePath(),e.fillStyle="rgba(255, 0, 0, .65)",e.fill(),e.restore()}},{key:"frozen",value:function(t){var e=this.ctx,n=t.x,i=t.y,r=n+t.width-1;e.save(),e.beginPath(),e.moveTo(Be(r-8),Be(i-1)),e.lineTo(Be(r),Be(i-1)),e.lineTo(Be(r),Be(i+8)),e.closePath(),e.fillStyle="rgba(0, 255, 0, .85)",e.fill(),e.restore()}},{key:"rect",value:function(t,e){var n=this.ctx,i=t.x,r=t.y,a=t.width,o=t.height,l=t.bgcolor;n.save(),n.beginPath(),n.fillStyle=l||"#fff",n.rect(Le(i+1),Le(r+1),Be(a-2),Be(o-2)),n.clip(),n.fill(),e(),n.restore()}}]),t}(),Xe=[{pt:7.5,px:10},{pt:8,px:11},{pt:9,px:12},{pt:10,px:13},{pt:10.5,px:14},{pt:11,px:15},{pt:12,px:16},{pt:14,px:18.7},{pt:15,px:20},{pt:16,px:21.3},{pt:18,px:24},{pt:22,px:29.3},{pt:24,px:32},{pt:26,px:34.7},{pt:36,px:48},{pt:42,px:56}];function Ze(t){for(var e=0;e<Xe.length;e+=1){var n=Xe[e];if(n.pt===t)return n.px}return t}function Ke(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(i=(o=l.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{i||null==l.return||l.return()}finally{if(r)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Je=function(t){for(var e=[],n=[],i=[],r=0,a="",o=1,l="",s=0;s<t.length;s+=1){var c=t.charAt(s);if(" "!==c){if(c>="a"&&c<="z")i.push(c.toUpperCase());else if(c>="0"&&c<="9"||c>="A"&&c<="Z"||"."===c)i.push(c);else if('"'===c){for(s+=1;'"'!==t.charAt(s);)i.push(t.charAt(s)),s+=1;n.push('"'.concat(i.join(""))),i=[]}else if("-"===c&&/[+\-*/,(]/.test(l))i.push(c);else{if("("!==c&&i.length>0&&n.push(i.join("")),")"===c){var u=e.pop();if(2===r)try{for(var h=Ke(f(n.pop()),2),v=h[0],p=h[1],y=Ke(f(n.pop()),2),g=y[0],b=y[1],m=0,w=g;w<=v;w+=1)for(var k=b;k<=p;k+=1)n.push(d(w,k)),m+=1;n.push([u,m])}catch(t){}else if(1===r||3===r)3===r&&n.push(a),n.push([u,o]),o=1;else for(;"("!==u&&(n.push(u),!(e.length<=0));)u=e.pop();r=0}else if("="===c||">"===c||"<"===c){var x=t.charAt(s+1);a=c,"="!==x&&"-"!==x||(a+=x,s+=1),r=3}else if(":"===c)r=2;else if(","===c)3===r&&n.push(a),r=1,o+=1;else if("("===c&&i.length>0)e.push(i.join(""));else{if(e.length>0&&("+"===c||"-"===c)){var O=e[e.length-1];if("("!==O&&n.push(e.pop()),"*"===O||"/"===O)for(;e.length>0&&"("!==(O=e[e.length-1]);)n.push(e.pop())}else if(e.length>0){var E=e[e.length-1];"*"!==E&&"/"!==E||n.push(e.pop())}e.push(c)}i=[]}l=c}}for(i.length>0&&n.push(i.join(""));e.length>0;)n.push(e.pop());return n},Ge=function(t,e){var n=Ke(t,1)[0],i=t;if('"'===n)return t.substring(1);var r=1;if("-"===n&&(i=t.substring(1),r=-1),i[0]>="0"&&i[0]<="9")return r*Number(i);var a=Ke(f(i),2);return r*e(a[0],a[1])},Qe=function(t,e,n,i){for(var r=[],a=0;a<t.length;a+=1){var o=t[a],l=o[0];if("+"===o){var s=r.pop();r.push(M("+",r.pop(),s))}else if("-"===o)if(1===r.length){var c=r.pop();r.push(M("*",c,-1))}else{var u=r.pop();r.push(M("-",r.pop(),u))}else if("*"===o)r.push(M("*",r.pop(),r.pop()));else if("/"===o){var h=r.pop();r.push(M("/",r.pop(),h))}else if("="===l||">"===l||"<"===l){var f=r.pop();Number.isNaN(f)||(f=Number(f));var d=r.pop();Number.isNaN(d)||(d=Number(d));var v=!1;"="===l?v=d===f:">"===o?v=d>f:">="===o?v=d>=f:"<"===o?v=d<f:"<="===o&&(v=d<=f),r.push(v)}else if(Array.isArray(o)){for(var p=Ke(o,2),y=p[0],g=p[1],b=[],m=0;m<g;m+=1)b.push(r.pop());r.push(e[y].render(b.reverse()))}else{if(i.includes(o))return 0;(l>="a"&&l<="z"||l>="A"&&l<="Z")&&i.push(o),r.push(Ge(o,n)),i.pop()}}return r[0]},tn=function t(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if("="===e[0]){var a=Je(e.substring(1));return a.length<=0?e:Qe(a,n,(function(e,a){return t(i(e,a),n,i,r)}),r)}return e};function en(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(i=(o=l.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{i||null==l.return||l.return()}finally{if(r)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function nn(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var rn=[{key:"SUM",title:X("formula.sum"),render:function(t){return t.reduce((function(t,e){return M("+",t,e)}),0)}},{key:"AVERAGE",title:X("formula.average"),render:function(t){return t.reduce((function(t,e){return Number(t)+Number(e)}),0)/t.length}},{key:"MAX",title:X("formula.max"),render:function(t){return Math.max.apply(Math,nn(t.map((function(t){return Number(t)}))))}},{key:"MIN",title:X("formula.min"),render:function(t){return Math.min.apply(Math,nn(t.map((function(t){return Number(t)}))))}},{key:"IF",title:X("formula._if"),render:function(t){var e=en(t,3),n=e[0],i=e[1],r=e[2];return n?i:r}},{key:"AND",title:X("formula.and"),render:function(t){return t.every((function(t){return t}))}},{key:"OR",title:X("formula.or"),render:function(t){return t.some((function(t){return t}))}},{key:"CONCAT",title:X("formula.concat"),render:function(t){return t.join("")}}],an=rn,on={};function ln(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||cn(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function sn(t){return function(t){if(Array.isArray(t))return t}(t)||cn(t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function cn(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}rn.forEach((function(t){on[t.key]=t}));var un=function(t){return t},hn=function(t){if(/^(-?\d*.?\d*)$/.test(t)){var e=sn(Number(t).toFixed(2).toString().split("\\.")),n=e[0],i=e.slice(1);return[n.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")].concat(ln(i))}return t},fn=[{key:"normal",title:X("format.normal"),type:"string",render:un},{key:"text",title:X("format.text"),type:"string",render:un},{key:"number",title:X("format.number"),type:"number",label:"1,000.12",render:hn},{key:"percent",title:X("format.percent"),type:"number",label:"10.12%",render:function(t){return"".concat(t,"%")}},{key:"rmb",title:X("format.rmb"),type:"number",label:"10.00",render:function(t){return"".concat(hn(t))}},{key:"usd",title:X("format.usd"),type:"number",label:"$10.00",render:function(t){return"$".concat(hn(t))}},{key:"eur",title:X("format.eur"),type:"number",label:"10.00",render:function(t){return"".concat(hn(t))}},{key:"date",title:X("format.date"),type:"date",label:"26/09/2008",render:un},{key:"time",title:X("format.time"),type:"date",label:"15:59:00",render:un},{key:"datetime",title:X("format.datetime"),type:"date",label:"26/09/2008 15:59:00",render:un},{key:"duration",title:X("format.duration"),type:"date",label:"24:01:00",render:un}],dn={};function vn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(i=(o=l.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{i||null==l.return||l.return()}finally{if(r)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function pn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}fn.forEach((function(t){dn[t.key]=t}));var yn={fillStyle:"#333333"},gn={fillStyle:"#fff",lineWidth:qe,strokeStyle:"#555"};function bn(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=t.cellRect(e,n),a=r.left,o=r.top,l=r.width,s=r.height;return new Ue(a,o+i,l,s,5)}function mn(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=e.sortedRowMap,o=e.rows,l=e.cols;if(!o.isHide(n)&&!l.isHide(i)){var s=n;a.has(n)&&(s=a.get(n));var c=e.getCell(s,i);if(null!==c){var u=!1;"editable"in c&&!1===c.editable&&(u=!0);var h=e.getCellStyleOrDefault(s,i),f=bn(e,n,i,r);f.bgcolor=h.bgcolor,void 0!==h.border&&(f.setBorders(h.border),t.strokeBorders(f)),t.rect(f,(function(){var r="";r=e.settings.evalPaused?c.text||"":tn(c.text||"",on,(function(t,n){return e.getCellTextOrDefault(n,t)})),h.format&&(r=dn[h.format].render(r));var a=Object.assign({},h.font);a.size=Ze(a.size),t.text(r,f,{align:h.align,valign:h.valign,font:a,color:h.color,strike:h.strike,underline:h.underline},h.textwrap),e.validations.getError(n,i)&&t.error(f),u&&t.frozen(f)}))}}}function wn(t){var e=this.data,n=this.draw;if(t){var i=e.autoFilter;if(!i.active())return;var r=i.hrange();t.intersects(r)&&r.each((function(t,i){var r=bn(e,t,i);n.dropdown(r)}))}}function kn(t,e,n,i,r){var a=this.draw,o=this.data;a.save(),a.translate(e,n).translate(i,r);var l=o.exceptRowSet,s=o.exceptRowTotalHeight(t.sri,t.eri);a.save(),a.translate(0,-s),t.each((function(t,e){mn(a,o,t,e)}),(function(t){return function(t){var e=l.has(t);if(e){var n=o.rows.getHeight(t);a.translate(0,-n)}return!e}(t)})),a.restore();var c=new Set;a.save(),a.translate(0,-s),o.eachMergesInView(t,(function(t){var e=t.sri,n=t.sci,i=t.eri;if(l.has(e)){if(!c.has(e)){c.add(e);var r=o.rows.sumHeight(e,i+1);a.translate(0,-r)}}else mn(a,o,e,n)})),a.restore(),wn.call(this,t),a.restore()}function xn(t,e,n,i){var r=this.draw;r.save(),r.attr({fillStyle:"rgba(75, 137, 255, 0.08)"}).fillRect(t,e,n,i),r.restore()}function On(t,e,n,i,r,a){var o=this,l=this.draw,s=this.data,c=e.h,h=e.w,f=a+i,d=r+n;l.save(),l.attr(yn),"all"!==t&&"left"!==t||l.fillRect(0,f,n,c),"all"!==t&&"top"!==t||l.fillRect(d,0,h,i);var v=s.selector.range,p=v.sri,y=v.sci,g=v.eri,b=v.eci;l.attr({textAlign:"center",textBaseline:"middle",font:"500 ".concat(Be(12),"px Arial"),fillStyle:"#EEE",lineWidth:qe(),strokeStyle:"#555555"}),"all"!==t&&"left"!==t||(s.rowEach(e.sri,e.eri,(function(t,e,i){var r=f+e,a=t;l.line([0,r],[n,r]),p<=a&&a<g+1&&xn.call(o,0,r,n,i),l.fillText(a+1,n/2,r+i/2),t>0&&s.rows.isHide(t-1)&&(l.save(),l.attr({strokeStyle:"#c6c6c6"}),l.line([5,r+5],[n-5,r+5]),l.restore())})),l.line([0,c+f],[n,c+f]),l.line([n,f],[n,c+f])),"all"!==t&&"top"!==t||(s.colEach(e.sci,e.eci,(function(t,e,n){var r=d+e,a=t;l.line([r,0],[r,i]),y<=a&&a<b+1&&xn.call(o,r,0,n,i),l.fillText(u(a),r+n/2,i/2),t>0&&s.cols.isHide(t-1)&&(l.save(),l.attr({strokeStyle:"#c6c6c6"}),l.line([r+5,5],[r+5,i-5]),l.restore())})),l.line([h+d,0],[h+d,i]),l.line([0,i],[h+d,i])),l.restore()}function En(t,e){var n=this.draw;n.save(),n.attr({fillStyle:"#333333"}).fillRect(0,0,t,e),n.restore()}function Cn(t,e,n,i,r){var a=t.sri,o=t.sci,l=t.eri,s=t.eci,c=t.w,u=t.h,h=this.draw,f=this.data,d=f.settings;h.save(),h.attr(gn).translate(e+i,n+r),d.showGrid?(f.rowEach(a,l,(function(t,e,n){t!==a&&h.line([0,e],[c,e]),t===l&&h.line([0,e+n],[c,e+n])})),f.colEach(o,s,(function(t,e,n){t!==o&&h.line([e,0],[e,u]),t===s&&h.line([e+n,0],[e+n,u])})),h.restore()):h.restore()}function Sn(t,e,n,i){var r=this.draw,a=this.data,o=a.viewWidth()-t,l=a.viewHeight()-e;r.save().translate(t,e).attr({strokeStyle:"rgba(75, 137, 255, .6)"}),r.line([0,i],[o,i]),r.line([n,0],[n,l]),r.restore()}var An=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.el=e,this.draw=new $e(e,n.viewWidth(),n.viewHeight()),this.data=n}var e,n,i;return e=t,(n=[{key:"resetData",value:function(t){this.data=t,this.render()}},{key:"render",value:function(){var t=this.data,e=t.rows,n=t.cols.indexWidth,i=e.height;this.draw.resize(t.viewWidth(),t.viewHeight()),this.clear();var r=t.viewRange(),a=t.freezeTotalWidth(),o=t.freezeTotalHeight(),l=t.scroll,s=l.x,c=l.y;Cn.call(this,r,n,i,a,o),kn.call(this,r,n,i,-s,-c),On.call(this,"all",r,n,i,a,o),En.call(this,n,i);var u=vn(t.freeze,2),h=u[0],f=u[1];if(h>0||f>0){if(h>0){var d=r.clone();d.sri=0,d.eri=h-1,d.h=o,Cn.call(this,d,n,i,a,0),kn.call(this,d,n,i,-s,0),On.call(this,"top",d,n,i,a,0)}if(f>0){var v=r.clone();v.sci=0,v.eci=f-1,v.w=a,Cn.call(this,v,n,i,0,o),On.call(this,"left",v,n,i,0,o),kn.call(this,v,n,i,0,-c)}var p=t.freezeViewRange();Cn.call(this,p,n,i,0,0),On.call(this,"all",p,n,i,0,0),kn.call(this,p,n,i,0,0),Sn.call(this,n,i,a,o)}}},{key:"clear",value:function(){this.draw.clear()}}])&&pn(e.prototype,n),i&&pn(e,i),t}();function Tn(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function jn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Dn=[["A3",11.69,16.54],["A4",8.27,11.69],["A5",5.83,8.27],["B4",9.84,13.9],["B5",6.93,9.84]],In=["landscape","portrait"];function Rn(t){return parseInt(96*t,10)}function Pn(t){"cancel"===t?this.el.hide():this.toPrint()}function _n(t){var e=this.paper,n=t.target.value,i=Dn[n];e.w=Rn(i[1]),e.h=Rn(i[2]),this.preview()}function zn(t){var e=this.paper,n=t.target.value,i=In[n];e.orientation=i,this.preview()}var Hn=function(){function t(e){var n,i;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.paper={w:Rn(Dn[0][1]),h:Rn(Dn[0][2]),padding:50,orientation:In[0],get width(){return"landscape"===this.orientation?this.h:this.w},get height(){return"landscape"===this.orientation?this.w:this.h}},this.data=e,this.el=l("div","".concat(At,"-print")).children(l("div","".concat(At,"-print-bar")).children(l("div","-title").child("Print settings"),l("div","-right").children(l("div","".concat(At,"-buttons")).children(new ze("cancel").on("click",Pn.bind(this,"cancel")),new ze("next","primary").on("click",Pn.bind(this,"next"))))),l("div","".concat(At,"-print-content")).children(this.contentEl=l("div","-content"),l("div","-sider").child(l("form","").children(l("fieldset","").children(l("label","").child("".concat($("print.size"))),(n=l("select","")).children.apply(n,Tn(Dn.map((function(t,e){return l("option","").attr("value",e).child("".concat(t[0]," ( ").concat(t[1],"''x").concat(t[2],"'' )"))})))).on("change",_n.bind(this))),l("fieldset","").children(l("label","").child("".concat($("print.orientation"))),(i=l("select","")).children.apply(i,Tn(In.map((function(t,e){return l("option","").attr("value",e).child("".concat($("print.orientations")[e]))})))).on("change",zn.bind(this))))))).hide()}var e,n,i;return e=t,(n=[{key:"resetData",value:function(t){this.data=t}},{key:"preview",value:function(){var t=this,e=this.data,n=this.paper,i=n.width,r=n.height,a=n.padding,o=i-2*a,s=r-2*a,c=e.contentRange(),u=parseInt(c.h/s,10)+1,h=o/c.w,f=a,d=a;h>1&&(f+=(o-c.w)/2);var v=0,p=0;this.contentEl.html(""),this.canvases=[];for(var y={sri:0,sci:0,eri:0,eci:0},g=function(n){var a=0,o=0,u=l("div","".concat(At,"-canvas-card")),g=l("canvas","".concat(At,"-canvas"));t.canvases.push(g.el);var b=new $e(g.el,i,r);for(b.save(),b.translate(f,d),h<1&&b.scale(h,h);v<=c.eri;v+=1){var m=e.rows.getHeight(v);if(!((a+=m)<s)){o=-(a-m);break}for(var w=0;w<=c.eci;w+=1)mn(b,e,v,w,p),y.eci=w}y.eri=v,b.restore(),b.save(),b.translate(f,d),h<1&&b.scale(h,h);var k=p;e.eachMergesInView(y,(function(t){var n=t.sri,i=t.sci;mn(b,e,n,i,k)})),b.restore(),y.sri=y.eri,y.sci=y.eci,p+=o,t.contentEl.child(l("div","".concat(At,"-canvas-card-wraper")).child(u.child(g)))},b=0;b<u;b+=1)g();this.el.show()}},{key:"toPrint",value:function(){this.el.hide();var t=this.paper,e=l("iframe","").hide().el;window.document.body.appendChild(e);var n=e.contentWindow,i=n.document,r=document.createElement("style");r.innerHTML="\n      @page { size: ".concat(t.width,"px ").concat(t.height,"px; };\n      canvas {\n        page-break-before: auto;        \n        page-break-after: always;\n        image-rendering: pixelated;\n      };\n    "),i.head.appendChild(r),this.canvases.forEach((function(t){var e=t.cloneNode(!1);e.getContext("2d").drawImage(t,0,0),i.body.appendChild(e)})),n.print()}}])&&jn(e.prototype,n),i&&jn(e,i),t}();function Mn(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Fn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Nn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Wn=[{key:"copy",title:X("contextmenu.copy"),label:"Ctrl+C"},{key:"cut",title:X("contextmenu.cut"),label:"Ctrl+X"},{key:"paste",title:X("contextmenu.paste"),label:"Ctrl+V"},{key:"paste-value",title:X("contextmenu.pasteValue"),label:"Ctrl+Shift+V"},{key:"paste-format",title:X("contextmenu.pasteFormat"),label:"Ctrl+Alt+V"},{key:"divider"},{key:"insert-row",title:X("contextmenu.insertRow")},{key:"insert-column",title:X("contextmenu.insertColumn")},{key:"divider"},{key:"delete-row",title:X("contextmenu.deleteRow")},{key:"delete-column",title:X("contextmenu.deleteColumn")},{key:"delete-cell-text",title:X("contextmenu.deleteCellText")},{key:"hide",title:X("contextmenu.hide")}];function Vn(t){var e=this;return"divider"===t.key?l("div","".concat(At,"-item divider")):l("div","".concat(At,"-item")).on("click",(function(){e.itemClick(t.key),e.hide()})).children(t.title(),l("div","label").child(t.label||""))}function qn(){var t=this;return Wn.map((function(e){return Vn.call(t,e)}))}var Bn=function(){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Fn(this,t),this.menuItems=qn.call(this),this.el=(n=l("div","".concat(At,"-contextmenu"))).children.apply(n,Mn(this.menuItems)).hide(),this.viewFn=e,this.itemClick=function(){},this.isHide=i,this.setMode("range")}var e,n,i;return e=t,(n=[{key:"setMode",value:function(t){var e=this.menuItems[12];"row-col"===t?e.show():e.hide()}},{key:"hide",value:function(){var t=this.el;t.hide(),Ot(t)}},{key:"setPosition",value:function(t,e){if(!this.isHide){var n=this.el,i=n.show().offset().width,r=this.viewFn(),a=r.height/2,o=t;r.width-t<=i&&(o-=i),n.css("left","".concat(o,"px")),e>a?n.css("bottom","".concat(r.height-e,"px")).css("max-height","".concat(e,"px")).css("top","auto"):n.css("top","".concat(e,"px")).css("max-height","".concat(r.height-e,"px")).css("bottom","auto"),Et(n)}}}])&&Nn(e.prototype,n),i&&Nn(e,i),t}();function Ln(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Un=function(){function t(e,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tip="",e&&(this.tip=$("toolbar.".concat(e.replace(/-[a-z]/g,(function(t){return t[1].toUpperCase()}))))),n&&(this.tip+=" (".concat(n,")")),this.tag=e,this.shortcut=n,this.value=i,this.el=this.element(),this.change=function(){}}var e,n,i;return e=t,(n=[{key:"element",value:function(){var t=this,e=this.tip;return l("div","".concat(At,"-toolbar-btn")).on("mouseenter",(function(e){t.tip&&function(t,e){if(!e.classList.contains("active")){var n=e.getBoundingClientRect(),i=n.left,r=n.top,a=n.width,o=n.height,s=l("div","".concat(At,"-tooltip")).html(t).show();document.body.appendChild(s.el);var c=s.box();s.css("left","".concat(i+a/2-c.width/2,"px")).css("top","".concat(r+o+2,"px")),kt(e,"mouseleave",(function(){document.body.contains(s.el)&&document.body.removeChild(s.el)})),kt(e,"click",(function(){document.body.contains(s.el)&&document.body.removeChild(s.el)}))}}(t.tip,e.target)})).attr("data-tooltip",e)}},{key:"setState",value:function(){}}])&&Ln(e.prototype,n),i&&Ln(e,i),t}();function Yn(t){return(Yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Zn(t,e){return!e||"object"!==Yn(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Kn(t){return(Kn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Jn(t,e){return(Jn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Gn=function(t){function e(t,n,i,r){var a,o;$n(this,e),(o=Zn(this,Kn(e).call(this,"div","".concat(At,"-dropdown ").concat(r)))).title=t,o.change=function(){},o.headerClick=function(){},"string"==typeof t?o.title=l("div","".concat(At,"-dropdown-title")).child(t):i&&o.title.addClass("arrow-left"),o.contentEl=l("div","".concat(At,"-dropdown-content")).css("width",n).hide();for(var s=arguments.length,c=new Array(s>4?s-4:0),u=4;u<s;u++)c[u-4]=arguments[u];return(a=o).setContentChildren.apply(a,c),o.headerEl=l("div","".concat(At,"-dropdown-header")),o.headerEl.on("click",(function(){"block"!==o.contentEl.css("display")?o.show():o.hide()})).children(o.title,i?l("div","".concat(At,"-icon arrow-right")).child(l("div","".concat(At,"-icon-img arrow-down"))):""),o.children(o.headerEl,o.contentEl),o}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Jn(t,e)}(e,t),n=e,(i=[{key:"setContentChildren",value:function(){var t;this.contentEl.html(""),arguments.length>0&&(t=this.contentEl).children.apply(t,arguments)}},{key:"setTitle",value:function(t){this.title.html(t),this.hide()}},{key:"show",value:function(){var t=this;this.contentEl.show(),this.parent().active(),Et(this.parent(),(function(){t.hide()}))}},{key:"hide",value:function(){this.parent().active(!1),this.contentEl.hide(),Ot(this.parent())}}])&&Xn(n.prototype,i),r&&Xn(n,r),e}(o);function Qn(t){return(Qn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ti(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ei(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ni(t,e){return!e||"object"!==Qn(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ii(t,e,n){return(ii="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ri(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function ri(t){return(ri=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ai(t,e){return(ai=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var oi=function(t){function e(){return ti(this,e),ni(this,ri(e).apply(this,arguments))}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ai(t,e)}(e,t),n=e,(i=[{key:"element",value:function(){var t=this,n=this.tag;return ii(ri(e.prototype),"element",this).call(this).child(new he(n)).on("click",(function(){return t.click()}))}},{key:"click",value:function(){this.change(this.tag,this.toggle())}},{key:"setState",value:function(t){this.el.active(t)}},{key:"toggle",value:function(){return this.el.toggle()}},{key:"active",value:function(){return this.el.hasClass("active")}}])&&ei(n.prototype,i),r&&ei(n,r),e}(Un);function li(t){return(li="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function si(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ci(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ui(t,e){return!e||"object"!==li(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function hi(t,e,n){return(hi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=fi(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function fi(t){return(fi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function di(t,e){return(di=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var vi=function(t){function e(){return si(this,e),ui(this,fi(e).apply(this,arguments))}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&di(t,e)}(e,t),n=e,(i=[{key:"element",value:function(){var t=this;return hi(fi(e.prototype),"element",this).call(this).child(new he(this.tag)).on("click",(function(){return t.change(t.tag)}))}},{key:"setState",value:function(t){this.el.disabled(t)}}])&&ci(n.prototype,i),r&&ci(n,r),e}(Un);function pi(t){return(pi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yi(t,e){return!e||"object"!==pi(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function gi(t){return(gi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function bi(t,e){return(bi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var mi=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),yi(this,gi(e).call(this,"freeze"))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&bi(t,e)}(e,t),e}(oi);function wi(t){return(wi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ki(t,e){return!e||"object"!==wi(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function xi(t){return(xi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Oi(t,e){return(Oi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Ei=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),ki(this,xi(e).call(this,"redo","Ctrl+Y"))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Oi(t,e)}(e,t),e}(vi);function Ci(t){return(Ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Si(t,e){return!e||"object"!==Ci(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ai(t){return(Ai=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ti(t,e){return(Ti=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ji=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),Si(this,Ai(e).call(this,"undo","Ctrl+Z"))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ti(t,e)}(e,t),e}(vi);function Di(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ii(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ri(){var t=this;this.btns2=[],this.items.forEach((function(e){if(Array.isArray(e))e.forEach((function(e){var n=e.el,i=n.box(),r=n.computedStyle(),a=r.marginLeft,o=r.marginRight;t.btns2.push([n,i.width+parseInt(a,10)+parseInt(o,10)])}));else{var n=e.box(),i=e.computedStyle(),r=i.marginLeft,a=i.marginRight;t.btns2.push([e,n.width+parseInt(r,10)+parseInt(a,10)])}}))}var Pi=function(){function t(e,n){var i=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Di(this,t),this.data=e,this.change=function(){},this.widthFn=n,this.isHide=r;e.defaultStyle();this.items=[[this.undoEl=new ji,this.redoEl=new Ei,this.freezeEl=new mi]],this.el=l("div","".concat(At,"-toolbar")),this.btns=l("div","".concat(At,"-toolbar-btns")),this.items.forEach((function(t){Array.isArray(t)?t.forEach((function(t){i.btns.child(t.el),t.change=function(){i.change.apply(i,arguments)}})):i.btns.child(t.el)})),this.el.child(this.btns),r?this.el.hide():(this.reset(),setTimeout((function(){Ri.call(i)}),0),kt(window,"resize",(function(){})))}var e,n,i;return e=t,(n=[{key:"paintformatActive",value:function(){}},{key:"paintformatToggle",value:function(){this.paintformatEl.toggle()}},{key:"trigger",value:function(t){this["".concat(t,"El")].click()}},{key:"resetData",value:function(t){this.data=t,this.reset()}},{key:"reset",value:function(){if(!this.isHide){var t=this.data;t.getSelectedCellStyle(),this.undoEl.setState(!t.canUndo()),this.redoEl.setState(!t.canRedo()),this.freezeEl.setState(t.freezeIsActive())}}}])&&Ii(e.prototype,n),i&&Ii(e,i),t}();function _i(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function zi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Hi(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Mi=function(){function t(e,n){var i,r=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"600px";zi(this,t),this.title=e,this.el=l("div","".concat(At,"-modal")).css("width",a).children(l("div","".concat(At,"-modal-header")).children(new he("close").on("click.stop",(function(){return r.hide()})),this.title),(i=l("div","".concat(At,"-modal-content"))).children.apply(i,_i(n))).hide()}var e,n,i;return e=t,(n=[{key:"show",value:function(){var t=this;this.dimmer=l("div","".concat(At,"-dimmer active")),document.body.appendChild(this.dimmer.el);var e=this.el.show().box(),n=e.width,i=e.height,r=document.documentElement,a=r.clientHeight,o=r.clientWidth;this.el.offset({left:(o-n)/2,top:(a-i)/3}),window.xkeydownEsc=function(e){27===e.keyCode&&t.hide()},kt(window,"keydown",window.xkeydownEsc)}},{key:"hide",value:function(){this.el.hide(),document.body.removeChild(this.dimmer.el),xt(window,"keydown",window.xkeydownEsc),delete window.xkeydownEsc}}])&&Hi(e.prototype,n),i&&Hi(e,i),t}();function Fi(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Ni=function(){function t(e,n){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.vchange=function(){},this.el=l("div","".concat(At,"-form-input")),this.input=l("input","").css("width",e).on("input",(function(t){return i.vchange(t)})).attr("placeholder",n),this.el.child(this.input)}var e,n,i;return e=t,(n=[{key:"focus",value:function(){var t=this;setTimeout((function(){t.input.el.focus()}),10)}},{key:"hint",value:function(t){this.input.attr("placeholder",t)}},{key:"val",value:function(t){return this.input.val(t)}}])&&Fi(e.prototype,n),i&&Fi(e,i),t}();function Wi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Vi(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var qi=function(){function t(e,n,i){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(t){return t},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){};Wi(this,t),this.key=e,this.getTitle=a,this.vchange=function(){},this.el=l("div","".concat(At,"-form-select")),this.suggest=new ae(n.map((function(t){return{key:t,title:r.getTitle(t)}})),(function(t){r.itemClick(t.key),o(t.key),r.vchange(t.key)}),i,this.el),this.el.children(this.itemEl=l("div","input-text").html(this.getTitle(e)),this.suggest.el).on("click",(function(){return r.show()}))}var e,n,i;return e=t,(n=[{key:"show",value:function(){this.suggest.search("")}},{key:"itemClick",value:function(t){this.key=t,this.itemEl.html(this.getTitle(t))}},{key:"val",value:function(t){return void 0!==t?(this.key=t,this.itemEl.html(this.getTitle(t)),this):this.key}}])&&Vi(e.prototype,n),i&&Vi(e,i),t}();function Bi(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Li={number:/(^\d+$)|(^\d+(\.\d{0,4})?$)/,date:/^\d{4}-\d{1,2}-\d{1,2}$/},Ui=function(){function t(e,n,i,r){var a=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.label="",this.rule=n,i&&(this.label=l("label","label").css("width","".concat(r,"px")).html(i)),this.tip=l("div","tip").child("tip").hide(),this.input=e,this.input.vchange=function(){return a.validate()},this.el=l("div","".concat(At,"-form-field")).children(this.label,e.el,this.tip)}var e,n,i;return e=t,(n=[{key:"isShow",value:function(){return"none"!==this.el.css("display")}},{key:"show",value:function(){this.el.show()}},{key:"hide",value:function(){return this.el.hide(),this}},{key:"val",value:function(t){return this.input.val(t)}},{key:"hint",value:function(t){this.input.hint(t)}},{key:"validate",value:function(){var t=this.input,e=this.rule,n=this.tip,i=this.el,r=t.val();return e.required&&/^\s*$/.test(r)?(n.html($("validation.required")),i.addClass("error"),!1):!e.type&&!e.pattern||(e.pattern||Li[e.type]).test(r)?(i.removeClass("error"),!0):(n.html($("validation.notMatch")),i.addClass("error"),!1)}}])&&Bi(e.prototype,n),i&&Bi(e,i),t}();function Yi(t){return(Yi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Xi(t,e){return!e||"object"!==Yi(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Zi(t){return(Zi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ki(t,e){return(Ki=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Ji=function(t){function e(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=new Ui(new qi("cell",["cell"],"100%",(function(t){return $("dataValidation.modeType.".concat(t))})),{required:!0},"".concat($("dataValidation.range"),":"),100),i=new Ui(new Ni("120px","E3 or E3:F12"),{required:!0,pattern:/^([A-Z]{1,2}[1-9]\d*)(:[A-Z]{1,2}[1-9]\d*)?$/}),r=new Ui(new qi("list",["list","number","date","phone","email"],"100%",(function(t){return $("dataValidation.type.".concat(t))}),(function(e){return t.criteriaSelected(e)})),{required:!0},"".concat($("dataValidation.criteria"),":"),100),a=new Ui(new qi("be",["be","nbe","eq","neq","lt","lte","gt","gte"],"160px",(function(t){return $("dataValidation.operator.".concat(t))}),(function(e){return t.criteriaOperatorSelected(e)})),{required:!0}).hide(),o=new Ui(new Ni("70px","10"),{required:!0}).hide(),s=new Ui(new Ni("70px","100"),{required:!0,type:"number"}).hide(),c=new Ui(new Ni("120px","a,b,c"),{required:!0}),u=new Ui(new Ni("70px","10"),{required:!0,type:"number"}).hide();return(t=Xi(this,Zi(e).call(this,$("contextmenu.validation"),[l("div","".concat(At,"-form-fields")).children(n.el,i.el),l("div","".concat(At,"-form-fields")).children(r.el,a.el,o.el,s.el,u.el,c.el),l("div","".concat(At,"-buttons")).children(new ze("cancel").on("click",(function(){return t.btnClick("cancel")})),new ze("remove").on("click",(function(){return t.btnClick("remove")})),new ze("save","primary").on("click",(function(){return t.btnClick("save")})))]))).mf=n,t.rf=i,t.cf=r,t.of=a,t.minvf=o,t.maxvf=s,t.vf=u,t.svf=c,t.change=function(){},t}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ki(t,e)}(e,t),n=e,(i=[{key:"showVf",value:function(t){var e="date"===t?"2018-11-12":"10",n=this.vf;n.input.hint(e),n.show()}},{key:"criteriaSelected",value:function(t){var e=this.of,n=this.minvf,i=this.maxvf,r=this.vf,a=this.svf;"date"===t||"number"===t?(e.show(),n.rule.type=t,i.rule.type=t,"date"===t?(n.hint("2018-11-12"),i.hint("2019-11-12")):(n.hint("10"),i.hint("100")),n.show(),i.show(),r.hide(),a.hide()):("list"===t?a.show():a.hide(),r.hide(),e.hide(),n.hide(),i.hide())}},{key:"criteriaOperatorSelected",value:function(t){if(t){var e=this.minvf,n=this.maxvf,i=this.vf;if("be"===t||"nbe"===t)e.show(),n.show(),i.hide();else{var r=this.cf.val();i.rule.type=r,"date"===r?i.hint("2018-11-12"):i.hint("10"),i.show(),e.hide(),n.hide()}}}},{key:"btnClick",value:function(t){if("cancel"===t)this.hide();else if("remove"===t)this.change("remove"),this.hide();else if("save"===t){for(var e=["mf","rf","cf","of","svf","vf","minvf","maxvf"],n=0;n<e.length;n+=1){var i=this[e[n]];if(i.isShow()&&!i.validate())return}var r=this.mf.val(),a=this.rf.val(),o=this.cf.val(),l=this.of.val(),s=this.svf.val();"number"!==o&&"date"!==o||(s="be"===l||"nbe"===l?[this.minvf.val(),this.maxvf.val()]:this.vf.val()),this.change("save",r,a,{type:o,operator:l,required:!1,value:s}),this.hide()}}},{key:"setValue",value:function(t){if(t){var e=this.mf,n=this.rf,i=this.cf,r=this.of,a=this.svf,o=this.vf,l=this.minvf,s=this.maxvf,c=t.mode,u=t.ref,h=t.validator||{type:"list"},f=h.type,d=h.operator,v=h.value;e.val(c||"cell"),n.val(u),i.val(f),r.val(d),Array.isArray(v)?(l.val(v[0]),s.val(v[1])):(a.val(v||""),o.val(v||"")),this.criteriaSelected(f),this.criteriaOperatorSelected(d)}this.show()}}])&&$i(n.prototype,i),r&&$i(n,r),e}(Mi);function Gi(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Qi(t){return l("div","".concat(At,"-item ").concat(t))}function tr(t){var e=this;return Qi("state").child($("sort.".concat(t))).on("click.stop",(function(){return e.itemClick(t)}))}function er(t){var e=this,n=this.filterbEl,i=this.filterValues;n.html(""),Object.keys(t).forEach((function(r,a){var o=t[r],s=i.includes(r)?"checked":"";n.child(l("div","".concat(At,"-item state ").concat(s)).on("click.stop",(function(){return e.filterClick(a,r)})).children(""===r?$("filter.empty"):r,l("div","label").html("(".concat(o,")"))))}))}function nr(){var t=this.filterhEl,e=this.filterValues,n=this.values;t.html("".concat(e.length," / ").concat(n.length)),t.checked(e.length===n.length)}var ir=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.filterbEl=l("div","".concat(At,"-body")),this.filterhEl=l("div","".concat(At,"-header state")).on("click.stop",(function(){return e.filterClick(0,"all")})),this.el=l("div","".concat(At,"-sort-filter")).children(this.sortAscEl=tr.call(this,"asc"),this.sortDescEl=tr.call(this,"desc"),Qi("divider"),l("div","".concat(At,"-filter")).children(this.filterhEl,this.filterbEl),l("div","".concat(At,"-buttons")).children(new ze("cancel").on("click",(function(){return e.btnClick("cancel")})),new ze("ok","primary").on("click",(function(){return e.btnClick("ok")})))).hide(),this.ci=null,this.sortDesc=null,this.values=null,this.filterValues=[]}var e,n,i;return e=t,(n=[{key:"btnClick",value:function(t){if("ok"===t){var e=this.ci,n=this.sort,i=this.filterValues;this.ok&&this.ok(e,n,"in",i)}this.hide()}},{key:"itemClick",value:function(t){this.sort=t;var e=this.sortAscEl,n=this.sortDescEl;e.checked("asc"===t),n.checked("desc"===t)}},{key:"filterClick",value:function(t,e){var n=this.filterbEl,i=this.filterValues,r=this.values,a=n.children();"all"===e?a.length===i.length?(this.filterValues=[],a.forEach((function(t){return l(t).checked(!1)}))):(this.filterValues=Array.from(r),a.forEach((function(t){return l(t).checked(!0)}))):l(a[t]).toggle("checked")?i.push(e):i.splice(i.findIndex((function(t){return t===e})),1),nr.call(this)}},{key:"set",value:function(t,e,n,i){this.ci=t;var r=this.sortAscEl,a=this.sortDescEl;null!==i?(this.sort=i.order,r.checked(i.asc()),a.checked(i.desc())):(this.sortDesc=null,r.checked(!1),a.checked(!1)),this.values=Object.keys(e),this.filterValues=n?Array.from(n.value):Object.keys(e),er.call(this,e,n),nr.call(this)}},{key:"setOffset",value:function(t){var e=this;this.el.offset(t).show();var n=1;Et(this.el,(function(){n<=0&&e.hide(),n-=1}))}},{key:"show",value:function(){this.el.show()}},{key:"hide",value:function(){this.el.hide(),Ot(this.el)}}])&&Gi(e.prototype,n),i&&Gi(e,i),t}();function rr(t,e){var n=l("div","".concat(At,"-toast")),i=l("div","".concat(At,"-dimmer active"));n.children(l("div","".concat(At,"-toast-header")).children(new he("close").on("click.stop",(function(){return document.body.removeChild(n.el),void document.body.removeChild(i.el)})),t),l("div","".concat(At,"-toast-content")).html(e)),document.body.appendChild(n.el),document.body.appendChild(i.el);var r=n.box(),a=r.width,o=r.height,s=document.documentElement,c=s.clientHeight,u=s.clientWidth;n.offset({left:(u-a)/2,top:(c-o)/3})}function ar(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function or(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(i=(o=l.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{i||null==l.return||l.return()}finally{if(r)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function lr(t,e){var n,i=this;return function(){for(var r=i,a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];var s=o;n||(n=setTimeout((function(){n=null,t.apply(r,s)}),e))}}function sr(){var t=this.data,e=this.verticalScrollbar,n=this.horizontalScrollbar,i=t.getSelectedRect(),r=i.l,a=i.t,o=i.left,l=i.top,s=i.width,c=i.height,u=this.getTableOffset();if(Math.abs(o)+s>u.width)n.move({left:r+s-u.width});else{var h=t.freezeTotalWidth();o<h&&n.move({left:r-1-h})}if(Math.abs(l)+c>u.height)e.move({top:a+c-u.height-1});else{var f=t.freezeTotalHeight();l<f&&e.move({top:a-1-f})}}function cr(t,e,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(-1!==e||-1!==n){var a=this.table,o=this.selector,l=this.toolbar,s=this.data,c=this.contextMenu;c.setMode(-1===e||-1===n?"row-col":"range");var u=s.getCell(e,n);t?(o.setEnd(e,n,r),this.trigger("cells-selected",u,o.range)):(o.set(e,n,i),this.trigger("cell-selected",u,e,n)),l.reset(),a.render()}}function ur(t,e){var n=this.selector,i=this.data,r=i.rows,a=i.cols,o=or(n.indexes,2),l=o[0],s=o[1],c=n.range,u=c.eri,h=c.eci;if(t){var f=or(n.moveIndexes,2);l=f[0],s=f[1]}"left"===e?s>0&&(s-=1):"right"===e?(h!==s&&(s=h),s<a.len-1&&(s+=1)):"up"===e?l>0&&(l-=1):"down"===e?(u!==l&&(l=u),l<r.len-1&&(l+=1)):"row-first"===e?s=0:"row-last"===e?s=a.len-1:"col-first"===e?l=0:"col-last"===e&&(l=r.len-1),t&&(n.moveIndexes=[l,s]),cr.call(this,t,l,s),sr.call(this)}function hr(t){if(0===t.buttons&&t.target.className!=="".concat(At,"-resizer-hover")){var e=t.offsetX,n=t.offsetY,i=this.rowResizer,r=this.colResizer,a=this.tableEl,o=this.data,l=o.rows,s=o.cols;if(e>s.indexWidth&&n>l.height)return i.hide(),void r.hide();var c=a.box(),u=o.getCellRectByXY(t.offsetX,t.offsetY);u.ri>=0&&-1===u.ci?(u.width=s.indexWidth,i.show(u,{width:c.width}),l.isHide(u.ri-1)?i.showUnhide(u.ri):i.hideUnhide()):i.hide(),-1===u.ri&&u.ci>=0?(u.height=l.height,r.show(u,{height:c.height}),s.isHide(u.ci-1)?r.showUnhide(u.ci):r.hideUnhide()):r.hide()}}function fr(t){var e=this.verticalScrollbar,n=this.horizontalScrollbar,i=this.data,r=e.scroll().top,a=n.scroll().left,o=i.rows,l=i.cols,s=t.deltaY,c=t.deltaX,u=function(t,e){var n=t,i=0;do{i=e(n),n+=1}while(i<=0);return i},h=function(t){if(t>0){var n=i.scroll.ri+1;if(n<o.len){var a=u(n,(function(t){return o.getHeight(t)}));e.move({top:r+a-1})}}else{var l=i.scroll.ri-1;if(l>=0){var s=u(l,(function(t){return o.getHeight(t)}));e.move({top:0===l?0:r-s})}}},f=Math.abs(s),d=Math.abs(c),v=Math.max(f,d);/Firefox/i.test(window.navigator.userAgent)&&lr(h(t.detail),50),v===d&&lr(function(t){if(t>0){var e=i.scroll.ci+1;if(e<l.len){var r=u(e,(function(t){return l.getWidth(t)}));n.move({left:a+r-1})}}else{var o=i.scroll.ci-1;if(o>=0){var s=u(o,(function(t){return l.getWidth(t)}));n.move({left:0===o?0:a-s})}}}(c),50),v===f&&lr(h(s),50)}function dr(t,e){var n=this.verticalScrollbar,i=this.horizontalScrollbar,r=n.scroll().top,a=i.scroll().left;"left"===t||"right"===t?i.move({left:a-e}):"up"!==t&&"down"!==t||n.move({top:r-e})}function vr(){var t=this.data,e=this.verticalScrollbar,n=this.getTableOffset().height,i=t.exceptRowTotalHeight(0,-1);e.set(n,t.rows.totalHeight()-i)}function pr(){var t=this.data,e=this.horizontalScrollbar,n=this.getTableOffset().width;t&&e.set(n,t.cols.totalWidth())}function yr(){var t=this.selector,e=this.data,n=this.editor,i=or(e.freeze,2),r=i[0],a=i[1];if(r>0||a>0){var o=e.freezeTotalWidth(),l=e.freezeTotalHeight();n.setFreezeLengths(o,l)}t.resetAreaOffset()}function gr(){var t=this.tableEl,e=this.overlayerEl,n=this.overlayerCEl,i=this.table,r=this.toolbar,a=this.selector,o=this.el,l=this.getTableOffset(),s=this.getRect();t.attr(s),e.offset(s),n.offset(l),o.css("width","".concat(s.width,"px")),vr.call(this),pr.call(this),yr.call(this),i.render(),r.reset(),a.reset()}function br(){var t=this.data,e=this.selector;t.clearClipboard(),e.hideClipboard()}function mr(){var t=this.data,e=this.selector;t.copy(),t.copyToSystemClipboard(),e.showClipboard()}function wr(){var t=this.data,e=this.selector;t.cut(),e.showClipboard()}function kr(t,e){var n=this.data;if("read"!==n.settings.mode)if(n.paste(t,(function(t){return rr("Tip",t)})))gr.call(this);else if(e){var i=e.clipboardData.getData("text/plain");this.data.pasteFromText(i),gr.call(this)}}function xr(){this.data.hideRowsOrCols(),gr.call(this)}function Or(t,e){this.data.unhideRowsOrCols(t,e),gr.call(this)}function Er(){this.data.autofilter(),gr.call(this)}function Cr(){var t=this.toolbar;t.paintformatActive()&&(kr.call(this,"format"),br.call(this),t.paintformatToggle())}function Sr(t){var e=this,n=this.selector,i=this.data,r=this.table,a=this.sortFilter,o=t.offsetX,l=t.offsetY,s=t.target.className==="".concat(At,"-selector-corner"),c=i.getCellRectByXY(o,l),u=c.left,h=c.top,f=c.width,d=c.height,v=c.ri,p=c.ci,y=i.autoFilter;if(y.includes(v,p)&&u+f-20<o&&h+d-20<l){var g=y.items(p,(function(t,e){return i.rows.getCell(t,e)}));return a.hide(),a.set(p,g,y.getFilter(p),y.getSort(p)),void a.setOffset({left:u,top:h+d+2})}t.shiftKey||(s?n.showAutofill(v,p):cr.call(this,!1,v,p),Ct(window,(function(t){var r=i.getCellRectByXY(t.offsetX,t.offsetY);v=r.ri,p=r.ci,s?n.showAutofill(v,p):1!==t.buttons||t.shiftKey||cr.call(e,!0,v,p,!0,!0)}),(function(){s&&n.arange&&"read"!==i.settings.mode&&i.autofill(n.arange,"all",(function(t){return rr("Tip",t)}))&&r.render(),n.hideAutofill(),Cr.call(e)}))),s||1!==t.buttons||t.shiftKey&&cr.call(this,!0,v,p)}function Ar(){var t=this.editor,e=this.data.getSelectedRect(),n=this.getTableOffset(),i="top";e.top>n.height/2&&(i="bottom"),t.setOffset(e,i)}function Tr(){var t=this.editor,e=this.data;"read"!==e.settings.mode&&(Ar.call(this),t.setCell(e.getSelectedCell(),e.getSelectedValidator()),br.call(this))}function jr(t){var e=this,n=this.data,i=this.table,r=this.selector;n.scrolly(t,(function(){r.resetBRLAreaOffset(),Ar.call(e),i.render()}))}function Dr(t){var e=this,n=this.data,i=this.table,r=this.selector;n.scrollx(t,(function(){r.resetBRTAreaOffset(),Ar.call(e),i.render()}))}function Ir(t,e){var n=t.ri,i=this.table,r=this.selector;this.data.rows.setHeight(n,e),i.render(),r.resetAreaOffset(),vr.call(this),Ar.call(this)}function Rr(t,e){var n=t.ci,i=this.table,r=this.selector;this.data.cols.setWidth(n,e),i.render(),r.resetAreaOffset(),pr.call(this),Ar.call(this)}function Pr(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"finished",n=this.data,i=this.table;if("read"!==n.settings.mode){n.setSelectedCellText(t,e);var r=n.selector,a=r.ri,o=r.ci;"finished"===e?i.render():this.trigger("cell-edited",t,a,o)}}function _r(t){var e=this.data;"read"!==e.settings.mode&&("insert-row"===t?e.insert("row"):"delete-row"===t?e.delete("row"):"insert-column"===t?e.insert("column"):"delete-column"===t?e.delete("column"):"delete-cell"===t?e.deleteCell():"delete-cell-format"===t?e.deleteCell("format"):"delete-cell-text"===t?e.deleteCell("text"):"cell-printable"===t?e.setSelectedCellAttr("printable",!0):"cell-non-printable"===t?e.setSelectedCellAttr("printable",!1):"cell-editable"===t?e.setSelectedCellAttr("editable",!0):"cell-non-editable"===t&&e.setSelectedCellAttr("editable",!1),br.call(this),gr.call(this))}function zr(t,e){var n=this.data;if("undo"===t)this.undo();else if("redo"===t)this.redo();else if("print"===t)this.print.preview();else if("paintformat"===t)!0===e?mr.call(this):br.call(this);else if("clearformat"===t)_r.call(this,"delete-cell-format");else if("link"===t);else if("chart"===t);else if("autofilter"===t)Er.call(this);else if("freeze"===t)if(e){var i=n.selector,r=i.ri,a=i.ci;this.freeze(r,a)}else this.freeze(0,0);else n.setSelectedCellAttr(t,e),"formula"!==t||n.selector.multiple()||Tr.call(this),gr.call(this)}function Hr(t,e,n,i){this.data.setAutoFilter(t,e,n,i),gr.call(this)}function Mr(){var t,e,n,i,r,a,o=this,l=this.selector,s=this.overlayerEl,c=this.rowResizer,u=this.colResizer,h=this.verticalScrollbar,f=this.horizontalScrollbar,d=this.editor,v=this.contextMenu,p=this.toolbar,y=this.modalValidation,g=this.sortFilter;s.on("mousemove",(function(t){hr.call(o,t)})).on("mousedown",(function(t){d.clear(),v.hide(),2===t.buttons?(o.data.xyInSelectedRect(t.offsetX,t.offsetY)||Sr.call(o,t),v.setPosition(t.offsetX,t.offsetY),t.stopPropagation()):2===t.detail?Tr.call(o):Sr.call(o,t)})).on("mousewheel.stop",(function(t){fr.call(o,t)})).on("mouseout",(function(t){var e=t.offsetX;t.offsetY<=0&&u.hide(),e<=0&&c.hide()})),l.inputChange=function(t){Pr.call(o,t,"input"),Tr.call(o)},t=s.el,n=(e={move:function(t,e){dr.call(o,t,e)}}).move,i=e.end,r=0,a=0,kt(t,"touchstart",(function(t){var e=t.touches[0],n=e.pageX,i=e.pageY;r=n,a=i})),kt(t,"touchmove",(function(t){if(n){var e=t.changedTouches[0],i=e.pageX,o=e.pageY,l=i-r,s=o-a;(Math.abs(l)>10||Math.abs(s)>10)&&(St(l,s,t,n),r=i,a=o),t.preventDefault()}})),kt(t,"touchend",(function(t){if(i){var e=t.changedTouches[0],n=e.pageX,o=e.pageY;St(n-r,o-a,t,i)}})),p.change=function(t,e){return zr.call(o,t,e)},g.ok=function(t,e,n,i){return Hr.call(o,t,e,n,i)},c.finishedFn=function(t,e){Ir.call(o,t,e)},u.finishedFn=function(t,e){Rr.call(o,t,e)},c.unhideFn=function(t){Or.call(o,"row",t)},u.unhideFn=function(t){Or.call(o,"col",t)},h.moveFn=function(t,e){jr.call(o,t,e)},f.moveFn=function(t,e){Dr.call(o,t,e)},d.change=function(t,e){Pr.call(o,e,t)},y.change=function(t){if("save"===t){for(var e,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(e=o.data).addValidation.apply(e,i)}else o.data.removeValidation()},v.itemClick=function(t){"validation"===t?y.setValue(o.data.getSelectedValidation()):"copy"===t?mr.call(o):"cut"===t?wr.call(o):"paste"===t?kr.call(o,"all"):"paste-value"===t?kr.call(o,"text"):"paste-format"===t?kr.call(o,"format"):"hide"===t?xr.call(o):_r.call(o,t)},kt(window,"resize",(function(){o.reload()})),kt(window,"click",(function(t){o.focusing=s.contains(t.target)})),kt(window,"paste",(function(t){o.focusing&&(kr.call(o,"all",t),t.preventDefault())})),kt(window,"keydown",(function(t){if(o.focusing){var e=t.keyCode||t.which,n=t.key,i=t.ctrlKey,r=t.shiftKey,a=t.metaKey;if(i||a)switch(e){case 90:o.undo(),t.preventDefault();break;case 89:o.redo(),t.preventDefault();break;case 67:mr.call(o),t.preventDefault();break;case 88:wr.call(o),t.preventDefault();break;case 85:p.trigger("underline"),t.preventDefault();break;case 86:break;case 37:ur.call(o,r,"row-first"),t.preventDefault();break;case 38:ur.call(o,r,"col-first"),t.preventDefault();break;case 39:ur.call(o,r,"row-last"),t.preventDefault();break;case 40:ur.call(o,r,"col-last"),t.preventDefault();break;case 32:cr.call(o,!1,-1,o.data.selector.ci,!1),t.preventDefault();break;case 66:p.trigger("bold");break;case 73:p.trigger("italic")}else{switch(e){case 32:r&&cr.call(o,!1,o.data.selector.ri,-1,!1);break;case 27:v.hide(),br.call(o);break;case 37:ur.call(o,r,"left"),t.preventDefault();break;case 38:ur.call(o,r,"up"),t.preventDefault();break;case 39:ur.call(o,r,"right"),t.preventDefault();break;case 40:ur.call(o,r,"down"),t.preventDefault();break;case 9:d.clear(),ur.call(o,!1,r?"left":"right"),t.preventDefault();break;case 13:d.clear(),ur.call(o,!1,r?"up":"down"),t.preventDefault();break;case 8:_r.call(o,"delete-cell-text"),t.preventDefault()}"Delete"===n?(_r.call(o,"delete-cell-text"),t.preventDefault()):e>=65&&e<=90||e>=48&&e<=57||e>=96&&e<=105||"="===t.key?(Pr.call(o,t.key,"input"),Tr.call(o)):113===e&&Tr.call(o)}}}))}var Fr=function(){function t(e,n){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.eventMap=function(){var t=new Map;function e(e,n){var i;return t.has(e)&&(i=t.get(e),Array.isArray(i)&&i.push(n)||!1)||t.set(e,[].concat(n))}function n(e,n){var i,r;return t.has(e)&&(i=t.get(e),(r=i.indexOf(n))>=0&&i.splice(r,1)&&0===t.get(e).length&&t.delete(e))}return{get current(){return t},on:e,once:function(t,i){return e(t,(function e(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];i.call.apply(i,[null].concat(a)),n(t,e)}))},fire:function(e,n){return t.has(e)&&function(){var i=t.get(e),r=!0,a=!1,o=void 0;try{for(var l,s=i[Symbol.iterator]();!(r=(l=s.next()).done);r=!0){var c=l.value;c.call.apply(c,[null].concat(wt(n)))}}catch(t){a=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}}()},removeListener:n,removeAllListeners:function(){t.clear()}}}();var r=n.settings,a=r.view,o=r.showToolbar,s=r.showContextmenu;this.el=l("div","".concat(At,"-sheet")),this.toolbar=new Pi(n,a.width,!o),this.print=new Hn(n),e.children(this.toolbar.el,this.el,this.print.el),this.data=n,this.tableEl=l("canvas","".concat(At,"-table")),this.rowResizer=new Dt(!1,n.rows.height),this.colResizer=new Dt(!0,n.cols.minWidth),this.verticalScrollbar=new Rt(!0),this.horizontalScrollbar=new Rt(!1),this.editor=new je(an,(function(){return i.getTableOffset()}),n.rows.height),this.modalValidation=new Ji,this.contextMenu=new Bn((function(){return i.getRect()}),!s),this.selector=new Jt(n),this.overlayerCEl=l("div","".concat(At,"-overlayer-content")).children(this.editor.el,this.selector.el),this.overlayerEl=l("div","".concat(At,"-overlayer")).child(this.overlayerCEl),this.sortFilter=new ir,this.el.children(this.tableEl,this.overlayerEl.el,this.rowResizer.el,this.colResizer.el,this.verticalScrollbar.el,this.horizontalScrollbar.el,this.contextMenu.el,this.modalValidation.el,this.sortFilter.el),this.table=new An(this.tableEl.el,n),Mr.call(this),gr.call(this),cr.call(this,!1,0,0)}var e,n,i;return e=t,(n=[{key:"on",value:function(t,e){return this.eventMap.on(t,e),this}},{key:"trigger",value:function(t){for(var e=this.eventMap,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e.fire(t,i)}},{key:"resetData",value:function(t){this.editor.clear(),this.data=t,vr.call(this),pr.call(this),this.toolbar.resetData(t),this.print.resetData(t),this.selector.resetData(t),this.table.resetData(t)}},{key:"loadData",value:function(t){return this.data.setData(t),gr.call(this),this}},{key:"freeze",value:function(t,e){return this.data.setFreeze(t,e),gr.call(this),this}},{key:"undo",value:function(){this.data.undo(),gr.call(this)}},{key:"redo",value:function(){this.data.redo(),gr.call(this)}},{key:"reload",value:function(){return gr.call(this),this}},{key:"getRect",value:function(){var t=this.data;return{width:t.viewWidth(),height:t.viewHeight()}}},{key:"getTableOffset",value:function(){var t=this.data,e=t.rows,n=t.cols,i=this.getRect(),r=i.width,a=i.height;return{width:r-n.indexWidth,height:a-e.height,left:n.indexWidth,top:e.height}}}])&&ar(e.prototype,n),i&&ar(e,i),t}();function Nr(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(i=(o=l.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{i||null==l.return||l.return()}finally{if(r)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Wr(t){return(Wr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Vr(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function qr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Br(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Lr(t,e,n){return e&&Br(t.prototype,e),n&&Br(t,n),t}function Ur(t,e){return!e||"object"!==Wr(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Yr(t){return(Yr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function $r(t,e){return($r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Xr=function(t){function e(t){var n;qr(this,e);var i=new he("ellipsis");return(n=Ur(this,Yr(e).call(this,i,"auto",!1,"top-left"))).contentClick=t,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&$r(t,e)}(e,t),Lr(e,[{key:"reset",value:function(t){var e=this,n=t.map((function(t,n){return l("div","".concat(At,"-item")).css("width","150px").css("font-weight","normal").on("click",(function(){e.contentClick(n),e.hide()})).child(t)}));this.setContentChildren.apply(this,Vr(n))}},{key:"setTitle",value:function(){}}]),e}(Gn),Zr=[{key:"delete",title:X("contextmenu.deleteSheet")}];function Kr(t){var e=this;return l("div","".concat(At,"-item")).child(t.title()).on("click",(function(){e.itemClick(t.key),e.hide()}))}function Jr(){var t=this;return Zr.map((function(e){return Kr.call(t,e)}))}var Gr=function(){function t(){var e;qr(this,t),this.el=(e=l("div","".concat(At,"-contextmenu")).css("width","160px")).children.apply(e,Vr(Jr.call(this))).hide(),this.itemClick=function(){}}return Lr(t,[{key:"hide",value:function(){var t=this.el;t.hide(),Ot(t)}},{key:"setOffset",value:function(t){var e=this.el;e.offset(t),e.show(),Et(e)}}]),t}(),Qr=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};qr(this,t),this.swapFunc=i,this.updateFunc=a,this.dataNames=[],this.activeEl=null,this.deleteEl=null,this.items=[],this.moreEl=new Xr((function(t){e.clickSwap2(e.items[t])})),this.contextMenu=new Gr,this.contextMenu.itemClick=r,this.el=l("div","".concat(At,"-bottombar")).children(this.contextMenu.el,this.menuEl=l("ul","".concat(At,"-menu")).child(l("li","").children(new he("add").on("click",(function(){n()})),l("span","").child(this.moreEl))))}return Lr(t,[{key:"addItem",value:function(t,e){var n=this;this.dataNames.push(t);var i=l("li",e?"active":"").child(t);i.on("click",(function(){n.clickSwap2(i)})).on("contextmenu",(function(t){var e=t.target,r=e.offsetLeft,a=e.offsetHeight;n.contextMenu.setOffset({left:r,bottom:a+1}),n.deleteEl=i})).on("dblclick",(function(){var t=i.html(),e=new Ni("auto","");e.val(t),e.input.on("blur",(function(e){var i=e.target.value,r=n.dataNames.findIndex((function(e){return e===t}));n.renameItem(r,i)})),i.html("").child(e.el),e.focus()})),e&&this.clickSwap(i),this.items.push(i),this.menuEl.child(i),this.moreEl.reset(this.dataNames)}},{key:"renameItem",value:function(t,e){this.dataNames.splice(t,1,e),this.moreEl.reset(this.dataNames),this.items[t].html("").child(e),this.updateFunc(t,e)}},{key:"clear",value:function(){var t=this;this.items.forEach((function(e){t.menuEl.removeChild(e.el)})),this.items=[],this.dataNames=[],this.moreEl.reset(this.dataNames)}},{key:"deleteItem",value:function(){var t=this.activeEl,e=this.deleteEl;if(this.items.length>1){var n=this.items.findIndex((function(t){return t===e}));if(this.items.splice(n,1),this.dataNames.splice(n,1),this.menuEl.removeChild(e.el),this.moreEl.reset(this.dataNames),t===e){var i=Nr(this.items,1)[0];return this.activeEl=i,this.activeEl.toggle(),[n,0]}return[n,-1]}return[-1]}},{key:"clickSwap2",value:function(t){var e=this.items.findIndex((function(e){return e===t}));this.clickSwap(t),this.activeEl.toggle(),this.swapFunc(e)}},{key:"clickSwap",value:function(t){null!==this.activeEl&&this.activeEl.toggle(),this.activeEl=t}},{key:"getCurrentSheetIndex",value:function(){var t=this;return this.items.findIndex((function(e){return e===t.activeEl}))}}]),t}();n(1);function ta(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(i=(o=l.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{i||null==l.return||l.return()}finally{if(r)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ea(t,e){var n=Object.keys(t);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(t)),e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n}function na(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ea(n,!0).forEach((function(e){ia(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ea(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ia(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ra(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function aa(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}n.d(e,"spreadsheet",(function(){return la}));var oa=function(){function t(e){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ra(this,t);var r=e;this.options=na({showBottomBar:!0},i),this.sheetIndex=1,this.datas=[],"string"==typeof e&&(r=document.querySelector(e)),this.bottombar=this.options.showBottomBar?new Qr((function(){var t=n.addSheet();n.sheet.resetData(t)}),(function(t){var e=n.datas[t];n.sheet.resetData(e)}),(function(){n.deleteSheet()}),(function(t,e){n.datas[t].name=e})):null,this.data=this.addSheet();var a=l("div","".concat(At)).on("contextmenu",(function(t){return t.preventDefault()}));r.appendChild(a.el),this.sheet=new Fr(a,this.data),null!==this.bottombar&&a.child(this.bottombar.el)}var e,n,i;return e=t,i=[{key:"locale",value:function(t,e){Z(t,e)}}],(n=[{key:"addSheet",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=t||"sheet".concat(this.sheetIndex),r=new mt(i,this.options);return r.change=function(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];(t=e.sheet).trigger.apply(t,["change"].concat(i))},this.datas.push(r),null!==this.bottombar&&this.bottombar.addItem(i,n),this.sheetIndex+=1,r}},{key:"addSheetWithOptions",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0,r=t||"sheet".concat(this.sheetIndex),a=new mt(r,i);return a.change=function(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];(t=e.sheet).trigger.apply(t,["change"].concat(i))},this.datas.push(a),null!==this.bottombar&&this.bottombar.addItem(r,n),this.sheetIndex+=1,a}},{key:"getSheetData",value:function(){var t=this.bottombar.getCurrentSheetIndex();return this.datas[t]}},{key:"deleteSheet",value:function(){if(null!==this.bottombar){var t=ta(this.bottombar.deleteItem(),2),e=t[0],n=t[1];e>=0&&(this.datas.splice(e,1),n>=0&&this.sheet.resetData(this.datas[n]))}}},{key:"loadData",value:function(t){var e=Array.isArray(t)?t:[t];if(null!==this.bottombar&&this.bottombar.clear(),this.datas=[],e.length>0)for(var n=0;n<e.length;n+=1){var i=e[n],r=this.addSheet(i.name,0===n);r.setData(i),0===n&&this.sheet.resetData(r)}return this}},{key:"loadSheetWithOptions",value:function(t,e){var n=Array.isArray(t)?t:[t];if(n.length>0)for(var i=0;i<n.length;i+=1){var r=n[i],a=this.addSheetWithOptions(r.name,0===i,e);a.setData(r),0===i&&this.sheet.resetData(a)}return this}},{key:"getData",value:function(){return this.datas.map((function(t){return t.getData()}))}},{key:"cellText",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.datas[i].setCellText(t,e,n,"finished"),this}},{key:"cell",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.datas[n].getCell(t,e)}},{key:"cellStyle",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.datas[n].getCellStyle(t,e)}},{key:"reRender",value:function(){return this.sheet.table.render(),this}},{key:"on",value:function(t,e){return this.sheet.on(t,e),this}},{key:"validate",value:function(){return this.data.validations.errors.size<=0}},{key:"change",value:function(t){return this.sheet.on("change",t),this}}])&&aa(e.prototype,n),i&&aa(e,i),t}(),la=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new oa(t,e)};window&&(window.x_spreadsheet=la,window.x_spreadsheet.locale=function(t,e){return Z(t,e)});e.default=oa}]);
//# sourceMappingURL=xspreadsheet.js.map